Core.ListingTable=function(e,f,b){var a=this,d=[],g=-1,c;this.currentsort={key:f,dir:b,other:(b=="up"?"down":"up")};this.$table=e;this.$tableheads=this.$table.find("th[data-sortkey]");this.storagename="core-listingtable-columns-"+e.data("table-name");this.mode="view";this.refreshColumns=function(){var j=JSON.parse(localStorage.getItem(a.storagename)),h;if(!j){return}for(h in j){if(j[h]){$("."+h).show()}else{$("."+h).hide()}}};a.$table.find("tr").each(function(){g++;if(g==0){$(this).children("th").each(function(){d.push($(this).attr("class"))})}else{c=0;$(this).children("td").each(function(){$(this).attr("class",d[c]);c++})}});a.$tableheads.each(function(){var h=$(this),i=h.data("sortkey");if(i==a.currentsort.key){h.append('<i class="sort-icon icon-sort-'+a.currentsort.dir+' current"></i>');h.append('<i class="sort-icon icon-sort-'+a.currentsort.other+' other"></i>')}else{h.append('<i class="sort-icon icon-sort other"></i>')}});a.$tableheads.click(function(){var j=$(this),i,h,k,l=j.data("sortkey");if(l==a.currentsort.key){i=a.currentsort.key;if(a.currentsort.dir=="up"){h="down"}else{h="up"}}else{i=l;h=a.currentsort.dir}k="sortkey="+i+"&sortdir="+h;window.location.search="?"+k});a.$table.find(".control-column-selection").click(function(){var h="",j,i;j=JSON.parse(localStorage.getItem(a.storagename));if(!j){j={}}if(typeof j!="object"){j={}}a.$table.find("th").each(function(){var k=$(this),l=k.data("viewkey");if(!l){return true}if(typeof j[l]=="undefined"){j[l]=!$(this).hasClass("column-optional")}h+='<label><input type="checkbox" name="'+k.data("viewkey")+'"';if(j[k.data("viewkey")]){h+=' checked="checked"'}h+=">&nbsp;"+k.data("viewtitle")+"</label>"});i=$('<div class="listing-table-column-select">'+h+"</div>");i.dialog({modal:true,title:"Select Columns",width:"75%",resizable:false}).find("input").change(function(){var k=$(this).attr("name");j[k]=!j[k];localStorage.setItem(a.storagename,JSON.stringify(j));a.refreshColumns()});return false});a.$table.find(".control-edit-toggle").click(function(){var k=$(this),j=k.closest("td").find(":input"),h=k.closest("tr").hasClass("edit-record-buttons"),i;if(j.length>0&&!h){i=k.closest("tr");e.find(".edit").hide();e.find(".view").show();i.find(".view").hide();i.find(".edit").show();a.mode="edit";e.find(".edit-record-buttons").show();j.first().select()}else{if(a.mode=="view"){e.find(".view").hide();e.find(".edit").show();a.mode="edit"}else{e.find(".view").show();e.find(".edit").hide();a.mode="view"}}return false});a.refreshColumns()};
$(function(){var a=0,c=false,d=$(".widget-dragsource"),b=$(".widget-droptarget");d.draggable({helper:"clone",connectToSortable:".widget-droptarget",opacity:0.5,revert:"invalid",appendTo:"body",start:function(g,f){b.addClass("highlightdroptarget")},stop:function(g,f){b.removeClass("highlightdroptarget")}});b.sortable({stop:function(k,i){var g=i.item,j,h,f;if(!g.attr("data-instanceid")){f="new-"+(++a);j=g.closest(".widgetarea");h=j.attr("data-area");g.find("input.baseurl").attr("name","widgetarea["+f+"][baseurl]");g.find("input.widgetaccess").attr("name","widgetarea["+f+"][widgetaccess]");g.find("input.widgetarea").attr("name","widgetarea["+f+"][widgetarea]").val(h);g.attr("data-instanceid",f)}g.removeClass("widget-dragsource").addClass("widget-dragdropped");c=true},helper:"original",revert:true});$(".widget-bucket-destination").delegate("a.control-delete","click",function(){var g=$(this),f=g.closest("div.widget-dragdropped"),e=f.attr("data-instanceid");console.log(e);if(e.indexOf("new-")===0){f.remove()}else{f.attr("data-instanceid","del-"+e).hide();f.find(":input").each(function(){var h=$(this),i=h.attr("name");h.attr("name",i.replace("widgetarea["+e+"]","widgetarea[del-"+e+"]"))})}c=true;return false});$(".widget-bucket-destination").delegate("a.control-edit","click",function(){Core.User.init();var j=$(this),i=j.closest(".widget-dragdropped"),h=i.find(".widgetaccess"),f=h.val(),e="",g=null;e=Core.User.AccessStrings.render({value:f});e+='<div><a class="button ok saveaccessstring">Set Access Settings</a></div>';g=$("<div/>");g.appendTo("body");g.html(e);g.show().dialog({modal:true,autoOpen:false,title:"Access Permissions",width:"500px",close:function(l,k){$(this).remove()}}).dialog("open");g.find(".saveaccessstring").click(function(){h.val(Core.User.AccessStrings.parsedom(g));g.dialog("close");return false});c=true;return false});$("#skin-selection-select").change(function(){if(c){if(!confirm("You have unsaved changed to the widgets, click Cancel if you want to save the widgets first.")){return false}}$(this).closest("form").submit()});Core.User.init()});
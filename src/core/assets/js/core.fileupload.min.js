// Helper function to help with the file upload logic.  There is a small amount of javascript for "prettifying"
Core.fileupload=function(h){var a=$("#"+h+"-selector"),b=$("#"+h+"-actions"),e=a.find(":checked").data("selectortype"),d={current:a.find(".fileinput-selector[data-selectortype=current]"),upload:a.find(".fileinput-selector[data-selectortype=upload]"),link:a.find(".fileinput-selector[data-selectortype=link]"),browse:a.find(".fileinput-selector[data-selectortype=browse]"),none:a.find(".fileinput-selector[data-selectortype=none]")},g={current:b.find(".fileinput-action[data-selectortype=current]"),upload:b.find(".fileinput-action[data-selectortype=upload]"),link:b.find(".fileinput-action[data-selectortype=link]"),browse:b.find(".fileinput-action[data-selectortype=browse]"),none:b.find(".fileinput-action[data-selectortype=none]")},c=false,f=((g.browse.length>0&&g.browse.data("accept").indexOf("image/")===0)?"image":"index");if(a.find(".fileinput-selector").length>1){a.show()}b.find(".fileinput-action").hide();b.show();g[e].show();if(e=="upload"){g.upload.find("input").removeAttr("disabled")}a.find(".fileinput-selector").click(function(){e=$(this).data("selectortype");b.children(".fileinput-action").hide();g[e].show();switch(e){case"upload":g.upload.find("input").removeAttr("disabled");break;case"browse":if(!c){load_browser(Core.ROOT_URL+"mediamanagernavigator/"+f+"?mode=list&ajax=1&controls=0&uploader=0");c=true}g.upload.find("input").attr("disabled","disabled");break;default:g.upload.find("input").attr("disabled","disabled");break}});g.link.find("input").change(function(){d.link.val("_link_://"+this.value)});load_browser=function(i){var j=g.browse.data("basedir");if(i.indexOf("&dir=")===-1){if(j.indexOf("public/")===0){j=j.substr(7);i+="&dir="+j}}g.browse.load(i,function(){Navigator.Setup();g.browse.find("a").click(function(){var k=$(this).attr("href");if(k!="#"){load_browser($(this).attr("href"));return false}});Navigator.SelectFile=function(k){d.browse.val("_browse_://"+k.attr("corename"));g.browse.find(".file.selected").removeClass("selected");k.closest(".file").addClass("selected");return false}})}};
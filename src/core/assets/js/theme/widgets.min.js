$(function(){var a=0;$(".widget-dragsource").draggable({helper:"clone",connectToSortable:".widget-dragtarget",opacity:0.5,revert:"invalid",appendTo:"body",start:function(c,b){$(".widget-dragtarget").addClass("highlightdroptarget")},stop:function(c,b){$(".widget-dragtarget").removeClass("highlightdroptarget")}});$(".widget-dragtarget").sortable({stop:function(h,f){var c=f.item,g,d,b;if(!c.attr("attr:instanceid")){b="new-"+(++a);g=c.closest(".widgetarea");d=g.attr("attr:area");c.find("input.baseurl").attr("name","widgetarea["+b+"][baseurl]");c.find("input.widgetaccess").attr("name","widgetarea["+b+"][widgetaccess]");c.find("input.widgetarea").attr("name","widgetarea["+b+"][widgetarea]").val(d);c.attr("attr:instanceid",b)}c.removeClass("widget-dragsource").addClass("widget-dragdropped")},helper:"original",revert:true});$(".widget-bucket-destination").delegate("a.control-delete","click",function(){var d=$(this),c=d.closest("div.widget-dragdropped"),b=c.attr("attr:instanceid");console.log(b);if(b.indexOf("new-")===0){c.remove()}else{c.attr("attr:instanceid","del-"+b).hide();c.find(":input").each(function(){var e=$(this),f=e.attr("name");e.attr("name",f.replace("widgetarea["+b+"]","widgetarea[del-"+b+"]"))})}return false});$(".widget-bucket-destination").delegate("a.control-edit","click",function(){var g=$(this),f=g.closest(".widget-dragdropped"),e=f.find(".widgetaccess"),c=e.val(),b="",d=null;b=Core.User.AccessStrings.render({value:c});b+='<div><a class="button ok saveaccessstring">Set Access Settings</a></div>';d=$("<div/>");d.appendTo("body");d.html(b);d.show().dialog({modal:true,autoOpen:false,title:"Access Permissions",width:"500px",close:function(i,h){$(this).remove()}}).dialog("open");d.find(".saveaccessstring").click(function(){e.val(Core.User.AccessStrings.parsedom(d));d.dialog("close");return false});return false});Core.User.init()});
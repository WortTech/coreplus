// Game of Life - JS & CSS
(function(){var a={columns:0,rows:0,waitTime:30,generation:0,timecount:0,timeval:0,running:false,autoplay:false,clear:{schedule:false},times:{algorithm:0,gui:0},element:{generation:null,steptime:null,livecells:null,hint:null,messages:{layout:null}},initialState:'[{"39":[110]},{"40":[112]},{"41":[109,110,113,114,115]}]',trail:{current:false,schedule:false},grid:{current:0,schemes:[{color:"#F3F3F3"},{color:"#FFFFFF"},{color:"#666666"},{color:""}]},zoom:{current:0,schedule:false,schemes:[{columns:Math.floor(window.outerWidth/8.2),rows:Math.floor(window.outerHeight/8.2),cellSize:8},{columns:450,rows:216,cellSize:1}]},colors:{current:0,schedule:false,schemes:[{dead:"#FFFFFF",trail:["#9898FF","#8585FF","#7272FF","#5F5FFF","#4C4CFF","#3939FF","#2626FF","#1313FF","#0000FF","#1313FF","#2626FF","#3939FF","#4C4CFF","#5F5FFF","#7272FF","#8585FF"],alive:["#000000"]},{dead:"#FFFFFF",trail:["#B5ECA2"],alive:["#9898FF","#8585FF","#7272FF","#5F5FFF","#4C4CFF","#3939FF","#2626FF","#1313FF","#0000FF","#1313FF","#2626FF","#3939FF","#4C4CFF","#5F5FFF","#7272FF","#8585FF"]},{dead:"#FFFFFF",trail:["#EE82EE","#FF0000","#FF7F00","#FFFF00","#008000 ","#0000FF","#4B0082"],alive:["#FF0000","#FF7F00","#FFFF00","#008000 ","#0000FF","#4B0082","#EE82EE"]}]},init:function(){try{this.listLife.init();this.loadConfig();this.loadState();this.keepDOMElements();this.canvas.init();this.registerEvents();this.prepare()}catch(b){alert("Error: "+b)}},loadConfig:function(){var b,c,d;this.autoplay=this.helpers.getUrlParameter("autoplay")==="1"?true:this.autoplay;this.trail.current=this.helpers.getUrlParameter("trail")==="1"?true:this.trail.current;b=parseInt(this.helpers.getUrlParameter("colors"),10);if(isNaN(b)||b<1||b>a.colors.schemes.length){b=1}c=parseInt(this.helpers.getUrlParameter("grid"),10);if(isNaN(c)||c<1||c>a.grid.schemes.length){c=1}d=parseInt(this.helpers.getUrlParameter("zoom"),10);if(isNaN(d)||d<1||d>a.zoom.schemes.length){d=1}this.colors.current=b-1;this.grid.current=c-1;this.zoom.current=d-1;this.rows=this.zoom.schemes[this.zoom.current].rows;this.columns=this.zoom.schemes[this.zoom.current].columns},loadState:function(){var e,c,b,f,d=this.helpers.getUrlParameter("s");if(d==="random"){this.randomState()}else{if(d==undefined){d=this.initialState;this.randomState()}e=$.parseJSON(decodeURI(d));for(c=0;c<e.length;c++){for(f in e[c]){for(b=0;b<e[c][f].length;b++){this.listLife.addCell(e[c][f][b],parseInt(f,10),this.listLife.actualState)}}}}},randomState:function(){var b,c=(this.rows*this.columns)*0.12;for(b=0;b<c;b++){this.listLife.addCell(this.helpers.random(0,this.columns-1),this.helpers.random(0,this.rows-1),this.listLife.actualState)}this.listLife.nextGeneration()},cleanUp:function(){this.listLife.init();this.prepare()},prepare:function(){this.generation=this.times.algorithm=this.times.gui=0;this.mouseDown=this.clear.schedule=false;this.element.generation.innerHTML="0";this.element.livecells.innerHTML="0";this.element.steptime.innerHTML="0 / 0 (0 / 0)";this.canvas.clearWorld();this.canvas.drawWorld();if(this.autoplay){this.autoplay=false;this.handlers.buttons.run()}},keepDOMElements:function(){this.element.generation=document.getElementById("generation");this.element.steptime=document.getElementById("steptime");this.element.livecells=document.getElementById("livecells");this.element.messages.layout=document.getElementById("layoutMessages");this.element.hint=document.getElementById("hint")},registerEvents:function(){this.helpers.registerEvent(document.getElementById("buttonRun"),"click",this.handlers.buttons.run,false);this.helpers.registerEvent(document.getElementById("buttonStep"),"click",this.handlers.buttons.step,false);this.helpers.registerEvent(document.getElementById("buttonClear"),"click",this.handlers.buttons.clear,false);this.helpers.registerEvent(document.getElementById("buttonExport"),"click",this.handlers.buttons.export_,false);this.helpers.registerEvent(document.getElementById("buttonTrail"),"click",this.handlers.buttons.trail,false);this.helpers.registerEvent(document.getElementById("buttonGrid"),"click",this.handlers.buttons.grid,false);this.helpers.registerEvent(document.getElementById("buttonColors"),"click",this.handlers.buttons.colors,false)},nextStep:function(){var c,b,h,e,d,g,f;g=(new Date());d=this.listLife.nextGeneration();g=(new Date())-g;f=(new Date());for(c=0;c<this.listLife.redrawList.length;c++){b=this.listLife.redrawList[c][0];h=this.listLife.redrawList[c][1];if(this.listLife.redrawList[c][2]===1){this.canvas.changeCelltoAlive(b,h)}else{if(this.listLife.redrawList[c][2]===2){this.canvas.keepCellAlive(b,h)}else{this.canvas.changeCelltoDead(b,h)}}}f=(new Date())-f;if(this.trail.schedule){this.trail.schedule=false;this.canvas.drawWorld()}if(this.grid.schedule){this.grid.schedule=false;this.canvas.drawWorld()}if(this.colors.schedule){this.colors.schedule=false;this.canvas.drawWorld()}this.generation++;this.element.generation.innerHTML=this.generation;this.element.livecells.innerHTML=d;e=1/this.generation;this.times.algorithm=(this.times.algorithm*(1-e))+(g*e);this.times.gui=(this.times.gui*(1-e))+(f*e);this.element.steptime.innerHTML=g+" / "+f+" ("+Math.round(this.times.algorithm)+" / "+Math.round(this.times.gui)+")";if(this.running){setTimeout(function(){a.nextStep()},this.waitTime)}else{if(this.clear.schedule){this.cleanUp()}}},handlers:{mouseDown:false,lastX:0,lastY:0,canvasMouseDown:function(c){var b=a.helpers.mousePosition(c);a.canvas.switchCell(b[0],b[1]);a.handlers.lastX=b[0];a.handlers.lastY=b[1];a.handlers.mouseDown=true},canvasMouseUp:function(){a.handlers.mouseDown=false},canvasMouseMove:function(c){if(a.handlers.mouseDown){var b=a.helpers.mousePosition(c);if((b[0]!==a.handlers.lastX)||(b[1]!==a.handlers.lastY)){a.canvas.switchCell(b[0],b[1]);a.handlers.lastX=b[0];a.handlers.lastY=b[1]}}},keyboard:function(c){var b=c;if(!b){b=window.event}if(b.keyCode===67){a.handlers.buttons.clear()}else{if(b.keyCode===82){a.handlers.buttons.run()}else{if(b.keyCode===83){a.handlers.buttons.step()}}}},buttons:{run:function(){a.element.hint.style.display="none";a.running=!a.running;if(a.running){a.nextStep();document.getElementById("buttonRun").value="Stop"}else{console.log(a.timeval/a.timecount);document.getElementById("buttonRun").value="Run"}},step:function(){if(!a.running){a.nextStep()}},clear:function(){if(a.running){a.clear.schedule=true;a.running=false;document.getElementById("buttonRun").value="Run"}else{a.cleanUp()}},trail:function(){a.element.messages.layout.innerHTML=a.trail.current?"Trail is Off":"Trail is On";a.trail.current=!a.trail.current;if(a.running){a.trail.schedule=true}else{a.canvas.drawWorld()}},colors:function(){a.colors.current=(a.colors.current+1)%a.colors.schemes.length;a.element.messages.layout.innerHTML="Color Scheme #"+(a.colors.current+1);if(a.running){a.colors.schedule=true}else{a.canvas.drawWorld()}},grid:function(){a.grid.current=(a.grid.current+1)%a.grid.schemes.length;a.element.messages.layout.innerHTML="Grid Scheme #"+(a.grid.current+1);if(a.running){a.grid.schedule=true}else{a.canvas.drawWorld()}},export_:function(){var d,c,b="",e="",f="";for(d=0;d<a.listLife.actualState.length;d++){e+='{"'+a.listLife.actualState[d][0]+'":[';for(c=1;c<a.listLife.actualState[d].length;c++){e+=a.listLife.actualState[d][c]+","}e=e.substring(0,e.length-1)+"]},"}e=e.substring(0,e.length-1)+"";if(e.length!==0){b=(window.location.href.indexOf("?")===-1)?window.location.href:window.location.href.slice(0,window.location.href.indexOf("?"));f="?autoplay=0&trail="+(a.trail.current?"1":"0")+"&grid="+(a.grid.current+1)+"&colors="+(a.colors.current+1)+"&zoom="+(a.zoom.current+1)+"&s=["+e+"]";document.getElementById("exportUrlLink").href=f;document.getElementById("exportTinyUrlLink").href="http://tinyurl.com/api-create.php?url="+b+f;document.getElementById("exportUrl").style.display="inline"}}}},canvas:{context:null,width:null,height:null,age:null,cellSize:null,cellSpace:null,init:function(){this.canvas=document.getElementById("canvas");this.context=this.canvas.getContext("2d");this.cellSize=a.zoom.schemes[a.zoom.current].cellSize;this.cellSpace=1;a.helpers.registerEvent(this.canvas,"mousedown",a.handlers.canvasMouseDown,false);a.helpers.registerEvent(document,"mouseup",a.handlers.canvasMouseUp,false);a.helpers.registerEvent(this.canvas,"mousemove",a.handlers.canvasMouseMove,false);this.clearWorld()},clearWorld:function(){var c,b;this.age=[];for(c=0;c<a.columns;c++){this.age[c]=[];for(b=0;b<a.rows;b++){this.age[c][b]=0}}},drawWorld:function(){var c,b;if(a.grid.schemes[a.grid.current].color===""){this.setNoGridOn();this.width=this.height=0}else{this.setNoGridOff();this.width=this.height=1}this.width=this.width+(this.cellSpace*a.columns)+(this.cellSize*a.columns);this.canvas.setAttribute("width",this.width);this.height=this.height+(this.cellSpace*a.rows)+(this.cellSize*a.rows);this.canvas.getAttribute("height",this.height);this.context.fillStyle=a.grid.schemes[a.grid.current].color;this.context.fillRect(0,0,this.width,this.height);for(c=0;c<a.columns;c++){for(b=0;b<a.rows;b++){if(a.listLife.isAlive(c,b)){this.drawCell(c,b,true)}else{this.drawCell(c,b,false)}}}},setNoGridOn:function(){this.cellSize=a.zoom.schemes[a.zoom.current].cellSize+1;this.cellSpace=0},setNoGridOff:function(){this.cellSize=a.zoom.schemes[a.zoom.current].cellSize;this.cellSpace=1},drawCell:function(c,b,d){if(d){if(this.age[c][b]>-1){this.context.fillStyle=a.colors.schemes[a.colors.current].alive[this.age[c][b]%a.colors.schemes[a.colors.current].alive.length]}}else{if(a.trail.current&&this.age[c][b]<0){this.context.fillStyle=a.colors.schemes[a.colors.current].trail[(this.age[c][b]*-1)%a.colors.schemes[a.colors.current].trail.length]}else{this.context.fillStyle=a.colors.schemes[a.colors.current].dead}}this.context.fillRect(this.cellSpace+(this.cellSpace*c)+(this.cellSize*c),this.cellSpace+(this.cellSpace*b)+(this.cellSize*b),this.cellSize,this.cellSize)},switchCell:function(c,b){if(a.listLife.isAlive(c,b)){this.changeCelltoDead(c,b);a.listLife.removeCell(c,b,a.listLife.actualState)}else{this.changeCelltoAlive(c,b);a.listLife.addCell(c,b,a.listLife.actualState)}},keepCellAlive:function(c,b){if(c>=0&&c<a.columns&&b>=0&&b<a.rows){this.age[c][b]++;this.drawCell(c,b,true)}},changeCelltoAlive:function(c,b){if(c>=0&&c<a.columns&&b>=0&&b<a.rows){this.age[c][b]=1;this.drawCell(c,b,true)}},changeCelltoDead:function(c,b){if(c>=0&&c<a.columns&&b>=0&&b<a.rows){this.age[c][b]=-this.age[c][b];this.drawCell(c,b,false)}}},listLife:{actualState:[],redrawList:[],init:function(){this.actualState=[]},nextGeneration:function(){var r,p,k,h,e,d,s,o,l,q=0,c,g,b={},f=[];this.redrawList=[];for(k=0;k<this.actualState.length;k++){this.topPointer=1;this.bottomPointer=1;for(h=1;h<this.actualState[k].length;h++){r=this.actualState[k][h];p=this.actualState[k][0];g=[[r-1,p-1,1],[r,p-1,1],[r+1,p-1,1],[r-1,p,1],[r+1,p,1],[r-1,p+1,1],[r,p+1,1],[r+1,p+1,1]];c=this.getNeighboursFromAlive(r,p,k,g);for(e=0;e<8;e++){if(g[e]!==undefined){s=g[e][0]+","+g[e][1];if(b[s]===undefined){b[s]=1}else{b[s]++}}}if(!(c===0||c===1||c>3)){this.addCell(r,p,f);q++;this.redrawList.push([r,p,2])}else{this.redrawList.push([r,p,0])}}}for(s in b){if(b[s]===3){s=s.split(",");o=parseInt(s[0],10);l=parseInt(s[1],10);this.addCell(o,l,f);q++;this.redrawList.push([o,l,1])}}this.actualState=f;return q},topPointer:1,middlePointer:1,bottomPointer:1,getNeighboursFromAlive:function(b,g,e,f){var d=0,c;if(this.actualState[e-1]!==undefined){if(this.actualState[e-1][0]===(g-1)){for(c=this.topPointer;c<this.actualState[e-1].length;c++){if(this.actualState[e-1][c]>=(b-1)){if(this.actualState[e-1][c]===(b-1)){f[0]=undefined;this.topPointer=c+1;d++}if(this.actualState[e-1][c]===b){f[1]=undefined;this.topPointer=c;d++}if(this.actualState[e-1][c]===(b+1)){f[2]=undefined;if(c==1){this.topPointer=1}else{this.topPointer=c-1}d++}if(this.actualState[e-1][c]>(b+1)){break}}}}}for(c=1;c<this.actualState[e].length;c++){if(this.actualState[e][c]>=(b-1)){if(this.actualState[e][c]===(b-1)){f[3]=undefined;d++}if(this.actualState[e][c]===(b+1)){f[4]=undefined;d++}if(this.actualState[e][c]>(b+1)){break}}}if(this.actualState[e+1]!==undefined){if(this.actualState[e+1][0]===(g+1)){for(c=this.bottomPointer;c<this.actualState[e+1].length;c++){if(this.actualState[e+1][c]>=(b-1)){if(this.actualState[e+1][c]===(b-1)){f[5]=undefined;this.bottomPointer=c+1;d++}if(this.actualState[e+1][c]===b){f[6]=undefined;this.bottomPointer=c;d++}if(this.actualState[e+1][c]===(b+1)){f[7]=undefined;if(c==1){this.bottomPointer=1}else{this.bottomPointer=c-1}d++}if(this.actualState[e+1][c]>(b+1)){break}}}}}return d},isAlive:function(b,e){var d,c;for(d=0;d<this.actualState.length;d++){if(this.actualState[d][0]===e){for(c=1;c<this.actualState[d].length;c++){if(this.actualState[d][c]===b){return true}}}}return false},removeCell:function(b,f,e){var d,c;for(d=0;d<e.length;d++){if(e[d][0]===f){if(e[d].length===2){e.splice(d,1)}else{for(c=1;c<e[d].length;c++){if(e[d][c]===b){e[d].splice(c,1)}}}}}},addCell:function(j,i,b){if(b.length===0){b.push([i,j]);return}var f,c,d,e,g=[],h;if(i<b[0][0]){g=[[i,j]];for(f=0;f<b.length;f++){g[f+1]=b[f]}for(f=0;f<g.length;f++){b[f]=g[f]}return}else{if(i>b[b.length-1][0]){b[b.length]=[i,j];return}else{for(c=0;c<b.length;c++){if(b[c][0]===i){e=[];h=false;for(d=1;d<b[c].length;d++){if((!h)&&(j<b[c][d])){e.push(j);h=!h}e.push(b[c][d])}e.unshift(i);if(!h){e.push(j)}b[c]=e;return}if(i<b[c][0]){g=[];for(f=0;f<b.length;f++){if(f===c){g[f]=[i,j];g[f+1]=b[f]}else{if(f<c){g[f]=b[f]}else{if(f>c){g[f+1]=b[f]}}}}for(f=0;f<g.length;f++){b[f]=g[f]}return}}}}}},helpers:{urlParameters:null,random:function(c,b){return c<=b?c+Math.round(Math.random()*(b-c)):null},getUrlParameter:function(c){if(this.urlParameters===null){var e,b,d;this.urlParameters=[];b=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(d=0;d<b.length;d++){e=b[d].split("=");this.urlParameters.push(e[0]);this.urlParameters[e[0]]=e[1]}}return this.urlParameters[c]},registerEvent:function(c,e,d,b){if(/msie/i.test(navigator.userAgent)){c.attachEvent("on"+e,d)}else{c.addEventListener(e,d,b)}},mousePosition:function(g){var c,l,j,d,i=0,h=0,k=0,f=0,b=a.zoom.schemes[a.zoom.current].cellSize+1;c=g;if(!c){c=window.event}if(c.pageX||c.pageY){i=c.pageX;h=c.pageY}else{if(c.clientX||c.clientY){i=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;h=c.clientY+document.body.scrollTop+document.documentElement.scrollTop}}d=c.target||c.srcElement;while(d.offsetParent){f+=d.offsetLeft;k+=d.offsetTop;d=d.offsetParent}d.pageTop=k;d.pageLeft=f;l=Math.ceil(((i-d.pageLeft)/b)-1);j=Math.ceil(((h-d.pageTop)/b)-1);return[l,j]}}};a.helpers.registerEvent(window,"load",function(){var b=document.getElementById("canvas");b.height=Math.floor(window.outerHeight-$("#primary-nav .navigation-menu").height()-$("header").height());a.init()},false)}());
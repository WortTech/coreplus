(function(e,c,a,g){var d="minimalect",f={theme:"",reset:false,transition:"fade",transition_time:150,remove_empty_option:true,searchable:true,ajax:null,debug:false,live:true,placeholder:"Select a choice",empty:"No results match your keyword.",error_message:"There was a problem with the request.",class_container:"minict_wrapper",class_group:"minict_group",class_empty:"minict_empty",class_active:"active",class_disabled:"disabled",class_selected:"selected",class_hidden:"hidden",class_highlighted:"highlighted",class_first:"minict_first",class_last:"minict_last",class_reset:"minict_reset",beforeinit:function(){},afterinit:function(){},onchange:function(){},onopen:function(){},onclose:function(){},onfilter:function(){}};function b(i,h){this.element=e(i);this.options=e.extend({},f,h);this._defaults=f;this._name=d;this.label=e('[for="'+this.element.attr("id")+'"]').attr("for","minict_"+this.element.attr("id"));this._init()}b.prototype={_init:function(){this.options.beforeinit();var j=this.options,h=this;this.wrapper=e('<div class="'+j.class_container+'"></div>');this.element.hide().after(this.wrapper);if(j.theme){this.wrapper.addClass(j.theme)}if(this.element.prop("disabled")){this.wrapper.addClass(j.class_disabled)}this.input=e("<span "+(j.searchable?'contenteditable="true"':"")+' data-placeholder="'+(this.element.find("option[selected]").text()||this.element.attr("placeholder")||(j.placeholder!=null)?j.placeholder:this.element.find("option:first").text())+'" '+(this.element.is("[tabindex]")?("tabindex="+this.element.attr("tabindex")):"")+">"+(this.element.find("option[selected]").html()||"")+"</span>").appendTo(this.wrapper);if(j.reset){this.reset=e('<a href="#" class="'+j.class_reset+'">&#215;</a>').appendTo(this.wrapper)}this.ul=e("<ul>"+this._parseSelect()+'<li class="'+j.class_empty+'">'+j.empty+"</li></ul>").appendTo(this.wrapper);this.items=this.wrapper.find("li");if(this.element.find("option[selected]").length){this._showResetLink();this.items.filter('[data-value="'+this.element.find("option[selected]").val()+'"]').addClass(j.class_selected)}e(a).on("click",function(){h._hideChoices(h.wrapper)});e("*").not(this.wrapper).not(this.wrapper.find("*")).on("focus",function(){h._hideChoices(h.wrapper)});this.wrapper.on("click",function(k){k.stopPropagation();if(!h.element.prop("multiple")&&!h.element.prop("disabled")){h._toggleChoices()}});this.label.on("click",function(k){k.stopPropagation();h.input.trigger("focus")});this.wrapper.on("click","li:not(."+j.class_group+", ."+j.class_empty+", ."+j.class_disabled+")",function(){h._selectChoice(e(this))});this.wrapper.on("click","li."+j.class_group+", li."+j.class_empty+", li."+j.class_disabled,function(k){k.stopPropagation();h.input.focus()});this.element.on("focus",function(){h.element.blur();h._showChoices()}).on("blur",h._hideChoices).on("update",h.update);if(j.reset){this.wrapper.on("click","a."+j.class_reset,function(k){k.stopPropagation();h._resetChoice();return false})}this.input.on("focus click",function(k){k.stopPropagation();if(!h.element.prop("disabled")){h._showChoices()}else{h.input.blur()}}).on("keydown",function(k){switch(k.keyCode){case 38:k.preventDefault();h._navigateChoices("up");break;case 40:k.preventDefault();h._navigateChoices("down");break;case 13:case 9:if(h.items.filter("."+j.class_highlighted).length){h._selectChoice(h.items.filter("."+j.class_highlighted))}else{if(h.input.text()){h._selectChoice(h.items.not("."+j.class_group+", ."+j.class_empty).filter(":visible").first())}}if(k.keyCode===13){k.preventDefault();h._hideChoices(h.wrapper)}break;case 27:k.preventDefault();h._hideChoices(h.wrapper);break}}).on("keyup",function(k){if(e.inArray(k.keyCode,[38,40,13,9,27])===-1){h._filterChoices()}});if(c.MutationObserver){this.observer=new MutationObserver(function(k){if(k.length>0){h.ul.html(h._parseSelect()+'<li class="'+j.class_empty+'">'+j.empty+"</li>");if(h.options.debug){console.log("Minimalect detected a DOM change for ",h.element)}}});this.observer.observe(h.element[0],{childList:true})}if(j.live){var i=this.element.val();setInterval(function(){if(i!=h.element.val()&&h.element.val()!=null&&h.element.val()!=""){i=h.element.val();if(typeof i=="array"){i.each(function(m,l){h._selectChoice(h.wrapper.find("li[data-value='"+l+"']"))})}else{h._selectChoice(h.wrapper.find("li[data-value='"+i+"']"))}}else{if(h.element.val()==null||h.element.val()==""){i=h.element.val();h.items.removeClass(h.options.class_selected);h.input.text("").attr("data-placeholder",h.options.placeholder)}}if(h.element.prop("disabled")){h.wrapper.addClass(j.class_disabled)}else{h.wrapper.removeClass(j.class_disabled)}},100)}j.afterinit()},_navigateChoices:function(i){var k=this,p=this.wrapper,n=this.options,q=this.items;var j="."+n.class_hidden+", ."+n.class_empty+", ."+n.class_group;if(!q.filter("."+n.class_highlighted).length){if(i==="up"){q.not(j).last().addClass(n.class_highlighted)}else{if(i==="down"){q.not(j).first().addClass(n.class_highlighted)}}return false}else{cur=q.filter("."+n.class_highlighted);cur.removeClass(n.class_highlighted);if(i==="up"){if(q.not(j).first()[0]!=cur[0]){cur.prevAll("li").not(j).first().addClass(n.class_highlighted);var l=q.filter("."+n.class_highlighted).offset().top-this.ul.offset().top+this.ul.scrollTop();if(this.ul.scrollTop()>l){this.ul.scrollTop(l)}}else{q.not(j).last().addClass(n.class_highlighted);this.ul.scrollTop(this.ul.height())}}else{if(i==="down"){if(q.not(j).last()[0]!=cur[0]){cur.nextAll("li").not(j).first().addClass(n.class_highlighted);var h=this.ul.height(),o=q.filter("."+n.class_highlighted).offset().top-this.ul.offset().top+q.filter("."+n.class_highlighted).outerHeight();if(h<o){this.ul.scrollTop(this.ul.scrollTop()+o-h)}}else{q.not(j).first().addClass(n.class_highlighted);this.ul.scrollTop(0)}}}}},_parseSelect:function(){var h=this,i="";if(!this.element.find("optgroup").length){i=this._parseElements(this.element.html())}else{this.element.find("optgroup").each(function(){i+='<li class="'+this.options.class_group+'">'+e(this).attr("label")+"</li>";i+=this._parseElements(e(this).html())})}return i},_parseElements:function(i){var h=this,j="";e(e.trim(i)).filter("option").each(function(){var k=e(this);if(k.attr("value")===""&&h.options.remove_empty_option){return}j+='<li data-value="'+k.val().replace(/"/g,"&quot;")+'" class="'+(k.attr("class")||"")+(k.prop("disabled")?" "+h.options.class_disabled:"")+'">'+k.text()+"</li>"});return j},_toggleChoices:function(){(!this.wrapper.hasClass(this.options.class_active))?this._showChoices():this._hideChoices(this.wrapper)},_showChoices:function(i){var h=this,j=this.wrapper,k=this.options;if(!j.hasClass(k.class_active)){this._updateFirstLast(false);e("."+k.class_container).each(function(){if(e(this)[0]!==j[0]){h._hideChoices(e(this))}});if(typeof i==="function"){i.call()}j.addClass(k.class_active);switch(k.transition){case"fade":this.ul.fadeIn(k.transition_time);break;default:this.ul.show();break}this.input.text("").focus();this._hideResetLink();this.options.onopen()}else{if(typeof i==="function"){i.call()}}},_resetDropdown:function(h){var i=this.options;this.items.removeClass(i.class_hidden);this.wrapper.find("."+i.class_empty).hide();this.items.filter("."+i.class_highlighted).removeClass(i.class_highlighted);if(typeof h==="function"){h.call()}},_hideChoices:function(j,i){var l=this.options,k=l.transition_time,h=this;if(j.hasClass(l.class_active)){j.removeClass(l.class_active);switch(l.transition){case"fade":j.children("ul").fadeOut(l.transition_time);break;default:j.children("ul").hide();k=0;break}setTimeout(function(){h._resetDropdown(i);h.input.blur();if(h.input.attr("data-placeholder")!=l.placeholder){h.input.text(h.input.attr("data-placeholder"))}else{if(!h.items.filter("."+l.class_selected).length){h.input.text("")}}},k);h._showResetLink();l.onclose()}else{if(typeof i==="function"){i.call()}}},_filterChoices:function(){var i=this.wrapper,k=this.options,h=this;if(k.ajax){e.post(k.ajax,{q:this.input.text()}).success(function(l){if(k.debug){console.log("Minimalect received ",l," for query '"+h.input.text()+"' in ",h.element)}if(l.length){var m="";e.each(l,function(o,n){m+='<option value="'+n.value+'">'+n.name+"</option>"});h.element.html(m);h.ul.html(h._parseSelect()+'<li class="'+k.class_empty+'">'+k.empty+"</li>");i.find("."+k.class_empty).hide();h.items=i.find("li");h.options.onfilter(true)}else{h.ul.html('<li class="'+k.class_empty+'">'+k.empty+"</li>");i.find("."+k.class_empty).show();if(k.debug){console.log("Minimalect didn't find any results for '"+h.input.text()+"' from ",h.element)}h.options.onfilter(false)}}).error(function(l){i.find("."+k.class_empty).text(k.error_message);i.find("li").not("."+k.class_empty).addClass(k.class_hidden);i.find("."+k.class_empty).show();if(k.debug){console.error("Minimalect's AJAX query failed for ",h.element," - came back with ",l)}})}else{var j=this.input.text().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");this.items.filter("."+k.class_highlighted).removeClass(k.class_highlighted);this.items.not(k.class_group).each(function(){if(e(this).text().search(new RegExp(j,"i"))<0||e(this).hasClass(k.class_disabled)){e(this).addClass(k.class_hidden)}else{e(this).removeClass(k.class_hidden)}});this.items.filter("."+k.class_group).removeClass(k.class_hidden).each(function(){nextlis=e(this).nextAll("li").not("."+k.class_hidden+", ."+k.class_empty);if(nextlis.first().hasClass(k.class_group)||!nextlis.length){e(this).addClass(k.class_hidden)}});i.find("."+k.class_empty).hide();if(!this.items.not("."+k.class_hidden+", ."+k.class_empty).length){i.find("."+k.class_empty).show();if(k.debug){console.log("Minimalect didn't find any results for '"+this.input.text()+"' from ",this.element)}this.options.onfilter(false)}else{this.options.onfilter(true)}this._updateFirstLast(true)}},_selectChoice:function(i){var h=this.element,l=this.options,j=[],k=[];if(i.hasClass(this.options.class_disabled)){return false}if(!this.element.prop("multiple")){this.items.removeClass(l.class_selected)}i.addClass(l.class_selected);this.items.filter("."+l.class_selected).each(function(){j.push(e(this).data("value"));k.push(e(this).text())});this.input.text(k.join(", ")).attr("data-placeholder",k.join(", "));if(h.val()!=i.data("value")||h.val()!=j){h.val(j);h.trigger("change")}this._showResetLink();this.options.onchange.call(this,i.data("value"),i.text())},_resetChoice:function(){this.element.val("").trigger("change");this._hideResetLink()},_showResetLink:function(){if(this.input.text().length>0||this.ul.find("li."+this.options.class_selected).length>0){this.options.reset&&this.reset.show()}},_hideResetLink:function(){this.options.reset&&this.reset.hide()},_updateFirstLast:function(i){var h=this.wrapper,j=this.options;h.find("."+j.class_first+", ."+j.class_last).removeClass(j.class_first+" "+j.class_last);if(i){this.items.filter(":visible").first().addClass(j.class_first);this.items.filter(":visible").last().addClass(j.class_last)}else{this.items.first().addClass(j.class_first);this.items.not("."+j.class_empty).last().addClass(j.class_last)}},destroy:function(){this.wrapper.remove();this.element.off("change focus blur").show();if(c.MutationObserver){this.observer.disconnect()}if(this.options.debug){console.log("Minimalect destroyed for ",this.element)}},update:function(){this.ul.html(this._parseSelect()+'<li class="'+this.options.class_empty+'">'+this.options.empty+"</li>")}};e.fn[d]=function(h,i){return this.each(function(){if(e.isFunction(b.prototype[h])&&h.charAt(0)!="_"){if(arguments.length==1){e.data(this,"plugin_"+d)[h]()}else{e.data(this,"plugin_"+d)[h](i)}}else{if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new b(this,h))}}})}})(jQuery,window,document);
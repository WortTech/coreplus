(function(){var b=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var d=CodeMirror.Pos;var g={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function c(r){var j=r.state._matchBrackets.maxScanLineLength||10000;var s=r.getCursor(),w=r.getLineHandle(s.line),q=s.ch-1;var l=(q>=0&&g[w.text.charAt(q)])||g[w.text.charAt(++q)];if(!l){return null}var m=l.charAt(1)==">",o=m?1:-1;var h=r.getTokenAt(d(s.line,q+1)).type;var p=[w.text.charAt(q)],t=/[(){}[\]]/;function v(x,D,C){if(!x.text){return}var B=m?0:x.text.length-1,i=m?x.text.length:-1;if(x.text.length>j){return null}var y=x.text.length<1000;if(C!=null){B=C+o}for(;B!=i;B+=o){var A=x.text.charAt(B);if(t.test(A)&&(!y||r.getTokenAt(d(D,B+1)).type==h)){var z=g[A];if(z.charAt(1)==">"==m){p.push(A)}else{if(p.pop()!=z.charAt(0)){return{pos:B,match:false}}else{if(!p.length){return{pos:B,match:true}}}}}}}for(var k=s.line,u,n=m?Math.min(k+100,r.lineCount()):Math.max(-1,k-100);k!=n;k+=o){if(k==s.line){u=v(w,k,q)}else{u=v(r.getLineHandle(k),k)}if(u){break}}return{from:d(s.line,q),to:u&&d(k,u.pos),match:u&&u.match}}function a(i,o){var l=i.state._matchBrackets.maxHighlightLineLength||1000;var n=c(i);if(!n||i.getLine(n.from.line).length>l||n.to&&i.getLine(n.to.line).length>l){return}var m=n.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";var k=i.markText(n.from,d(n.from.line,n.from.ch+1),{className:m});var j=n.to&&i.markText(n.to,d(n.to.line,n.to.ch+1),{className:m});if(b&&i.state.focused){i.display.input.focus()}var h=function(){i.operation(function(){k.clear();j&&j.clear()})};if(o){setTimeout(h,800)}else{return h}}var e=null;function f(h){h.operation(function(){if(e){e();e=null}if(!h.somethingSelected()){e=a(h,false)}})}CodeMirror.defineOption("matchBrackets",false,function(h,j,i){if(i&&i!=CodeMirror.Init){h.off("cursorActivity",f)}if(j){h.state._matchBrackets=typeof j=="object"?j:{};h.on("cursorActivity",f)}});CodeMirror.defineExtension("matchBrackets",function(){a(this,true)});CodeMirror.defineExtension("findMatchingBracket",function(){return c(this)})})();
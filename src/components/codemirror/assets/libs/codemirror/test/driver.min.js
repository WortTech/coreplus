var tests=[],debug=null,debugUsed=new Array(),allNames=[];function Failure(a){this.message=a}Failure.prototype.toString=function(){return this.message};function indexOf(d,a){if(d.indexOf){return d.indexOf(a)}for(var b=0,c=d.length;b<c;++b){if(d[b]==a){return b}}return -1}function test(c,e,a){var b=c;var d=2;while(indexOf(allNames,c)!==-1){c=b+"_"+d;d++}allNames.push(c);tests.push({name:c,func:e,expectedFail:a});return c}function testCM(b,d,c,a){return test("core_"+b,function(){var f=document.getElementById("testground"),e=CodeMirror(f,c);var g=false;try{d(e);g=true}finally{if((debug&&!g)||verbose){f.style.visibility="visible"}else{f.removeChild(e.getWrapperElement())}}},a)}function runTests(c){if(debug){if(indexOf(debug,"verbose")===0){verbose=true;debug.splice(0,1)}if(debug.length<1){debug=null}}var a=0;function b(j){if(j===tests.length){running=false;return c("done")}var m=tests[j],k=m.expectedFail,f=+new Date;if(debug!==null){var n=indexOf(debug,m.name);if(n!==-1){debug.splice(n,1)}else{var d=m.name.split("_")[0]+"_*";n=indexOf(debug,d);if(n!==-1){debug.splice(n,1);debugUsed.push(d)}else{n=indexOf(debugUsed,d);if(n==-1){return b(j+1)}}}}var g=false;try{var p=m.func()}catch(l){g=true;if(k){c("expected",m.name)}else{if(l instanceof Failure){c("fail",m.name,l.message)}else{var o=/\bat .*?([^\/:]+):(\d+):/.exec(l.stack);c("error",m.name,l.toString()+(o?" ("+o[1]+":"+o[2]+")":""))}}}if(!g){if(k){c("fail",m.name,p||"expected failure, but succeeded")}else{c("ok",m.name,p)}}if(!quit){var h=0;a+=(+new Date)-f;if(a>500){a=0;h=50}setTimeout(function(){b(j+1)},h)}else{running=false;return null}}b(0)}function label(b,a){if(a){return b+" ("+a+")"}return b}function eq(d,c,e){if(d!=c){throw new Failure(label(d+" != "+c,e))}}function eqPos(d,c,f){function e(a){return"{line:"+a.line+",ch:"+a.ch+"}"}if(d==c){return}if(d==null){throw new Failure(label("comparing null to "+e(c),f))}if(c==null){throw new Failure(label("comparing "+e(d)+" to null",f))}if(d.line!=c.line||d.ch!=c.ch){throw new Failure(label(e(d)+" != "+e(c),f))}}function is(b,c){if(!b){throw new Failure(label("assertion failed",c))}}function countTests(){if(!debug){return tests.length}var c=0;for(var b=0;b<tests.length;++b){var a=tests[b].name;if(indexOf(debug,a)!=-1||indexOf(debug,a.split("_")[0]+"_*")!=-1){++c}}return c};
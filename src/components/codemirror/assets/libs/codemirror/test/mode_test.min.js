// Helper to test CodeMirror highlighting modes. It pretty prints output of the
(function(){function g(j,k,h){for(;;){var i=j.indexOf(h,k);if(i==-1){return null}if(j.charAt(i+1)!=h){return i}k=i+2}}var d=/[\w&-_]+/g;function e(n){var q=[],s="";for(var l=0;l<n.length;++l){if(l){s+="\n"}var p=n[l],r=0;while(r<p.length){var h=null,t;if(p.charAt(r)=="["&&p.charAt(r+1)!="["){d.lastIndex=r+1;var j=d.exec(p);h=j[0].replace(/&/g," ");var o=r+h.length+2;var k=g(p,o,"]");if(k==null){throw new Error("Unterminated token at "+r+" in '"+p+"'"+h)}t=p.slice(o,k);r=k+1}else{var k=g(p,r,"[");if(k==null){k=p.length}t=p.slice(r,k);r=k}t=t.replace(/\[\[|\]\]/g,function(i){return i.charAt(0)});q.push(h,t);s+=t}}return{tokens:q,plain:s}}test.mode=function(h,k,j,l){var i=e(j);return test((l||k.name)+"_"+h,function(){return f(i.plain,i.tokens,k)})};function f(p,n,l){var q=[];for(var k=0;k<n.length;k+=2){var j=n[k];if(j&&j.indexOf(" ")){j=j.split(" ").sort().join(" ")}q.push(j,n[k+1])}var h=c(p,l);var o,m="";o=b(q,h);m=o?"mt-pass":"mt-fail";var r="";if(o){r+='<div class="mt-test '+m+'">';r+="<pre>"+p+"</pre>";r+='<div class="cm-s-default">';r+=a(h);r+="</div>";r+="</div>";return r}else{r+='<div class="mt-test '+m+'">';r+="<pre>"+p+"</pre>";r+='<div class="cm-s-default">';r+="expected:";r+=a(q);r+="observed:";r+=a(h);r+="</div>";r+="</div>";throw r}}function c(n,m){var j=m.startState();var s=n.replace(/\r\n/g,"\n").split("\n");var r=[],p=0;for(var l=0;l<s.length;++l){var t=s[l],o=true;var q=new CodeMirror.StringStream(t);if(t==""&&m.blankLine){m.blankLine(j)}while(!q.eol()){var h=m.token(q,j),k=q.current();if(h&&h.indexOf(" ")>-1){h=h.split(" ").sort().join(" ")}q.start=q.pos;if(p&&r[p-2]==h&&!o){r[p-1]+=k}else{if(k){r[p++]=h;r[p++]=k}}if(q.pos>5000){r[p++]=null;r[p++]=this.text.slice(q.pos);break}o=false}}return r}function b(k,j){if(k.length!=j.length){return false}for(var h=0;h<k.length;++h){if(k[h]!=j[h]){return false}}return true}function a(h){var l='<table class="mt-output">';l+="<tr>";for(var j=0;j<h.length;j+=2){var k=h[j],m=h[j+1];l+='<td class="mt-token"><span class="cm-'+String(k).replace(/ +/g," cm-")+'">'+m.replace(/ /g,"\xb7")+"</span></td>"}l+="</tr><tr>";for(var j=0;j<h.length;j+=2){l+='<td class="mt-style"><span>'+h[j]+"</span></td>"}l+="</table>";return l}})();
var code=" wOrd1 (#%\n word3] \naopop pop 0 1 2 3 4\n (a) [b] {c} \nint getchar(void) {\n  static char buf[BUFSIZ];\n  static char *bufp = buf;\n  if (n == 0) {  /* buffer is empty */\n    n = read(0, buf, sizeof buf);\n    bufp = buf;\n  }\n  return (--n >= 0) ? (unsigned char) *bufp++ : EOF;\n}\n";var lines=(function(){lineText=code.split("\n");var a=[];for(var b=0;b<lineText.length;b++){a[b]={line:b,length:lineText[b].length,lineText:lineText[b],textStart:/^\s*/.exec(lineText[b])[0].length}}return a})();var endOfDocument=makeCursor(lines.length-1,lines[lines.length-1].length);var wordLine=lines[0];var bigWordLine=lines[1];var charLine=lines[2];var bracesLine=lines[3];var word1={start:{line:wordLine.line,ch:1},end:{line:wordLine.line,ch:5}};var word2={start:{line:wordLine.line,ch:word1.end.ch+2},end:{line:wordLine.line,ch:word1.end.ch+4}};var word3={start:{line:bigWordLine.line,ch:1},end:{line:bigWordLine.line,ch:5}};var bigWord1=word1;var bigWord2=word2;var bigWord3={start:{line:bigWordLine.line,ch:1},end:{line:bigWordLine.line,ch:7}};var bigWord4={start:{line:bigWordLine.line,ch:bigWord1.end.ch+3},end:{line:bigWordLine.line,ch:bigWord1.end.ch+7}};var oChars=[{line:charLine.line,ch:1},{line:charLine.line,ch:3},{line:charLine.line,ch:7}];var pChars=[{line:charLine.line,ch:2},{line:charLine.line,ch:4},{line:charLine.line,ch:6},{line:charLine.line,ch:8}];var numChars=[{line:charLine.line,ch:10},{line:charLine.line,ch:12},{line:charLine.line,ch:14},{line:charLine.line,ch:16},{line:charLine.line,ch:18}];var parens1={start:{line:bracesLine.line,ch:1},end:{line:bracesLine.line,ch:3}};var squares1={start:{line:bracesLine.line,ch:5},end:{line:bracesLine.line,ch:7}};var curlys1={start:{line:bracesLine.line,ch:9},end:{line:bracesLine.line,ch:11}};function copyCursor(a){return{ch:a.ch,line:a.line}}function testVim(b,e,c,a){var d={lineNumbers:true,keyMap:"vim",showCursorWhenSelecting:true,value:code};for(var f in c){if(c.hasOwnProperty(f)){d[f]=c[f]}}return test("vim_"+b,function(){var i=document.getElementById("testground");var l=CodeMirror(i,d);CodeMirror.Vim.maybeInitState(l);var j=l.vimState;function m(p){return function(q){if(q instanceof Array){arguments=q}for(var r=0;r<arguments.length;r++){CodeMirror.Vim.handleKey(p,arguments[r])}}}function n(p){return function(q){p.openDialog=g.fakeOpenDialog(q);g.doKeys(":")}}function h(p){return function(q,r){var s;if(r==null&&typeof q.line=="number"){s=q}else{s=makeCursor(q,r)}eqPos(s,p.getCursor())}}function o(p){return function(q,r){return r(p)}}var g={doKeys:m(l),doEx:n(l),assertCursorAt:h(l),fakeOpenDialog:o,getRegisterController:function(){return CodeMirror.Vim.getRegisterController()}};CodeMirror.Vim.clearVimGlobalState_();var k=false;try{e(l,j,g);k=true}finally{if((debug&&!k)||verbose){i.style.visibility="visible"}else{i.removeChild(l.getWrapperElement())}}},a)}function testMotion(c,d,b,a){testVim(c,function(e,f,g){if(!a){a={line:0,ch:0}}e.setCursor(a);g.doKeys(d);g.assertCursorAt(b)})}function makeCursor(a,b){return{line:a,ch:b}}function offsetCursor(b,a,c){return{line:b.line+a,ch:b.ch+c}}testMotion("|","|",makeCursor(0,0),makeCursor(0,4));testMotion("|_repeat",["3","|"],makeCursor(0,2),makeCursor(0,4));testMotion("h","h",makeCursor(0,0),word1.start);testMotion("h_repeat",["3","h"],offsetCursor(word1.end,0,-3),word1.end);testMotion("l","l",makeCursor(0,1));testMotion("l_repeat",["2","l"],makeCursor(0,2));testMotion("j","j",offsetCursor(word1.end,1,0),word1.end);testMotion("j_repeat",["2","j"],offsetCursor(word1.end,2,0),word1.end);testMotion("k","k",offsetCursor(word3.end,-1,0),word3.end);testMotion("k_repeat",["2","k"],makeCursor(0,4),makeCursor(2,4));testMotion("w","w",word1.start);testMotion("w_repeat",["2","w"],word2.start);testMotion("w_wrap",["w"],word3.start,word2.start);testMotion("w_endOfDocument","w",endOfDocument,endOfDocument);testMotion("W","W",bigWord1.start);testMotion("W_repeat",["2","W"],bigWord3.start,bigWord1.start);testMotion("e","e",word1.end);testMotion("e_repeat",["2","e"],word2.end);testMotion("e_wrap","e",word3.end,word2.end);testMotion("e_endOfDocument","e",endOfDocument,endOfDocument);testMotion("b","b",word3.start,word3.end);testMotion("b_repeat",["2","b"],word2.start,word3.end);testMotion("b_wrap","b",word2.start,word3.start);testMotion("b_startOfDocument","b",makeCursor(0,0),makeCursor(0,0));testMotion("ge",["g","e"],word2.end,word3.end);testMotion("ge_repeat",["2","g","e"],word1.end,word3.start);testMotion("ge_wrap",["g","e"],word2.end,word3.start);testMotion("ge_startOfDocument",["g","e"],makeCursor(0,0),makeCursor(0,0));testMotion("gg",["g","g"],makeCursor(lines[0].line,lines[0].textStart),makeCursor(3,1));testMotion("gg_repeat",["3","g","g"],makeCursor(lines[2].line,lines[2].textStart));testMotion("G","G",makeCursor(lines[lines.length-1].line,lines[lines.length-1].textStart),makeCursor(3,1));testMotion("G_repeat",["3","G"],makeCursor(lines[2].line,lines[2].textStart));testMotion("0","0",makeCursor(0,0),makeCursor(0,8));testMotion("^","^",makeCursor(0,lines[0].textStart),makeCursor(0,8));testMotion("+","+",makeCursor(1,lines[1].textStart),makeCursor(0,8));testMotion("-","-",makeCursor(0,lines[0].textStart),makeCursor(1,4));testMotion("_",["6","_"],makeCursor(5,lines[5].textStart),makeCursor(0,8));testMotion("$","$",makeCursor(0,lines[0].length-1),makeCursor(0,1));testMotion("$_repeat",["2","$"],makeCursor(1,lines[1].length-1),makeCursor(0,3));testMotion("f",["f","p"],pChars[0],makeCursor(charLine.line,0));testMotion("f_repeat",["2","f","p"],pChars[2],pChars[0]);testMotion("f_num",["f","2"],numChars[2],makeCursor(charLine.line,0));testMotion("t",["t","p"],offsetCursor(pChars[0],0,-1),makeCursor(charLine.line,0));testMotion("t_repeat",["2","t","p"],offsetCursor(pChars[2],0,-1),pChars[0]);testMotion("F",["F","p"],pChars[0],pChars[1]);testMotion("F_repeat",["2","F","p"],pChars[0],pChars[2]);testMotion("T",["T","p"],offsetCursor(pChars[0],0,1),pChars[1]);testMotion("T_repeat",["2","T","p"],offsetCursor(pChars[0],0,1),pChars[2]);testMotion("%_parens",["%"],parens1.end,parens1.start);testMotion("%_squares",["%"],squares1.end,squares1.start);testMotion("%_braces",["%"],curlys1.end,curlys1.start);testVim("Changing lines after Eol operation",function(a,b,d){var c={line:0,ch:0};a.setCursor(c);d.doKeys(["$"]);d.doKeys(["j"]);d.assertCursorAt({line:1,ch:lines[1].length-1});d.doKeys(["j"]);d.assertCursorAt({line:2,ch:lines[2].length-1});d.doKeys(["h"]);d.doKeys(["j"]);d.assertCursorAt({line:3,ch:lines[3].length-1});d.doKeys(["j"]);d.doKeys(["j"]);d.assertCursorAt({line:5,ch:lines[2].length-2})});testVim("gj_gk_clipping",function(a,b,c){a.setCursor(0,1);c.doKeys("g","j","g","j");c.assertCursorAt(2,1);c.doKeys("g","k","g","k");c.assertCursorAt(0,1)},{value:"line 1\n\nline 2"});testVim("j_k_and_gj_gk",function(a,b,c){a.setSize(120);a.setCursor(0,0);c.doKeys("$");c.doKeys("g","k");var d=a.getCursor();eq(d.line,0);is((d.ch<176),"gk didn't move cursor back (1)");c.doKeys("g","j");c.assertCursorAt(0,176);c.doKeys("j");c.doKeys("3","g","k");d=a.getCursor();eq(d.line,1);is((d.ch<176),"gk didn't move cursor back (2)");c.doKeys("g","j","2","g","j");c.doKeys("k");c.assertCursorAt(0,176)},{lineWrapping:true,value:"This line is intentially long to test movement of gj and gk over wrapped lines. I will start on the end of this line, then make a step up and back to set the origin for j and k.\nThis line is supposed to be even longer than the previous. I will jump here and make another wiggle with gj and gk, before I jump back to the line above. Both wiggles should not change my cursor's target character but both j/k and gj/gk change each other's reference position."});testVim("gj_gk",function(a,b,e){if(phantom){return}a.setSize(120);a.setCursor(0,4);e.doKeys("g","j");e.doKeys("10","g","k");e.assertCursorAt(0,4);e.doKeys("g","j");var d=a.getCursor();var c={line:0,ch:(d.ch-4)*2+4};e.doKeys("g","j");e.assertCursorAt(c);a.setCursor(0,0);e.doKeys("h");e.doKeys("100","g","j");var h=a.getCursor();is(h!=0,"gj should not be on wrapped line 0");var g=a.charCoords(makeCursor(0,0));var f=a.charCoords(h);is(g.left==f.left,"gj should end up on column 0")},{lineNumbers:false,lineWrapping:true,value:"Thislineisintentiallylongtotestmovementofgjandgkoverwrappedlines."});testVim("}",function(a,b,c){a.setCursor(0,0);c.doKeys("}");c.assertCursorAt(1,0);a.setCursor(0,0);c.doKeys("2","}");c.assertCursorAt(4,0);a.setCursor(0,0);c.doKeys("6","}");c.assertCursorAt(5,0)},{value:"a\n\nb\nc\n\nd"});testVim("{",function(a,b,c){a.setCursor(5,0);c.doKeys("{");c.assertCursorAt(4,0);a.setCursor(5,0);c.doKeys("2","{");c.assertCursorAt(1,0);a.setCursor(5,0);c.doKeys("6","{");c.assertCursorAt(0,0)},{value:"a\n\nb\nc\n\nd"});testVim("dl",function(b,c,e){var a=makeCursor(0,0);b.setCursor(a);e.doKeys("d","l");eq("word1 ",b.getValue());var d=e.getRegisterController().getRegister();eq(" ",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1 "});testVim("dl_eol",function(b,c,e){var a=makeCursor(0,6);b.setCursor(a);e.doKeys("d","l");eq(" word1",b.getValue());var d=e.getRegisterController().getRegister();eq(" ",d.text);is(!d.linewise);e.assertCursorAt(0,6)},{value:" word1 "});testVim("dl_repeat",function(b,c,e){var a=makeCursor(0,0);b.setCursor(a);e.doKeys("2","d","l");eq("ord1 ",b.getValue());var d=e.getRegisterController().getRegister();eq(" w",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1 "});testVim("dh",function(b,c,e){var a=makeCursor(0,3);b.setCursor(a);e.doKeys("d","h");eq(" wrd1 ",b.getValue());var d=e.getRegisterController().getRegister();eq("o",d.text);is(!d.linewise);eqPos(offsetCursor(a,0,-1),b.getCursor())},{value:" word1 "});testVim("dj",function(b,c,e){var a=makeCursor(0,3);b.setCursor(a);e.doKeys("d","j");eq(" word3",b.getValue());var d=e.getRegisterController().getRegister();eq(" word1\nword2\n",d.text);is(d.linewise);e.assertCursorAt(0,1)},{value:" word1\nword2\n word3"});testVim("dj_end_of_document",function(b,c,e){var a=makeCursor(0,3);b.setCursor(a);e.doKeys("d","j");eq(" word1 ",b.getValue());var d=e.getRegisterController().getRegister();eq("",d.text);is(!d.linewise);e.assertCursorAt(0,3)},{value:" word1 "});testVim("dk",function(b,c,e){var a=makeCursor(1,3);b.setCursor(a);e.doKeys("d","k");eq(" word3",b.getValue());var d=e.getRegisterController().getRegister();eq(" word1\nword2\n",d.text);is(d.linewise);e.assertCursorAt(0,1)},{value:" word1\nword2\n word3"});testVim("dk_start_of_document",function(b,c,e){var a=makeCursor(0,3);b.setCursor(a);e.doKeys("d","k");eq(" word1 ",b.getValue());var d=e.getRegisterController().getRegister();eq("",d.text);is(!d.linewise);e.assertCursorAt(0,3)},{value:" word1 "});testVim("dw_space",function(b,c,e){var a=makeCursor(0,0);b.setCursor(a);e.doKeys("d","w");eq("word1 ",b.getValue());var d=e.getRegisterController().getRegister();eq(" ",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1 "});testVim("dw_word",function(b,c,e){var a=makeCursor(0,1);b.setCursor(a);e.doKeys("d","w");eq(" word2",b.getValue());var d=e.getRegisterController().getRegister();eq("word1 ",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1 word2"});testVim("dw_only_word",function(b,c,e){var a=makeCursor(0,1);b.setCursor(a);e.doKeys("d","w");eq(" ",b.getValue());var d=e.getRegisterController().getRegister();eq("word1 ",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1 "});testVim("dw_eol",function(b,c,e){var a=makeCursor(0,1);b.setCursor(a);e.doKeys("d","w");eq(" \nword2",b.getValue());var d=e.getRegisterController().getRegister();eq("word1",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1\nword2"});testVim("dw_repeat",function(b,c,e){var a=makeCursor(0,1);b.setCursor(a);e.doKeys("d","2","w");eq(" ",b.getValue());var d=e.getRegisterController().getRegister();eq("word1\nword2",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1\nword2"});testVim("d_inclusive",function(b,c,e){var a=makeCursor(0,1);b.setCursor(a);e.doKeys("d","e");eq("  ",b.getValue());var d=e.getRegisterController().getRegister();eq("word1",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1 "});testVim("d_reverse",function(a,b,d){a.setCursor(1,0);d.doKeys("d","b");eq(" word2 ",a.getValue());var c=d.getRegisterController().getRegister();eq("word1\n",c.text);is(!c.linewise);d.assertCursorAt(0,1)},{value:" word1\nword2 "});testVim("dd",function(a,b,d){a.setCursor(0,3);var e=a.getRange({line:0,ch:0},{line:1,ch:0});var f=a.lineCount()-1;d.doKeys("d","d");eq(f,a.lineCount());var c=d.getRegisterController().getRegister();eq(e,c.text);is(c.linewise);d.assertCursorAt(0,lines[1].textStart)});testVim("dd_prefix_repeat",function(a,b,d){a.setCursor(0,3);var e=a.getRange({line:0,ch:0},{line:2,ch:0});var f=a.lineCount()-2;d.doKeys("2","d","d");eq(f,a.lineCount());var c=d.getRegisterController().getRegister();eq(e,c.text);is(c.linewise);d.assertCursorAt(0,lines[2].textStart)});testVim("dd_motion_repeat",function(a,b,d){a.setCursor(0,3);var e=a.getRange({line:0,ch:0},{line:2,ch:0});var f=a.lineCount()-2;d.doKeys("d","2","d");eq(f,a.lineCount());var c=d.getRegisterController().getRegister();eq(e,c.text);is(c.linewise);d.assertCursorAt(0,lines[2].textStart)});testVim("dd_multiply_repeat",function(a,b,d){a.setCursor(0,3);var e=a.getRange({line:0,ch:0},{line:6,ch:0});var f=a.lineCount()-6;d.doKeys("2","d","3","d");eq(f,a.lineCount());var c=d.getRegisterController().getRegister();eq(e,c.text);is(c.linewise);d.assertCursorAt(0,lines[6].textStart)});testVim("yw_repeat",function(b,c,e){var a=makeCursor(0,1);b.setCursor(a);e.doKeys("y","2","w");eq(" word1\nword2",b.getValue());var d=e.getRegisterController().getRegister();eq("word1\nword2",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1\nword2"});testVim("yy_multiply_repeat",function(b,c,e){var a=makeCursor(0,3);b.setCursor(a);var f=b.getRange({line:0,ch:0},{line:6,ch:0});var g=b.lineCount();e.doKeys("2","y","3","y");eq(g,b.lineCount());var d=e.getRegisterController().getRegister();eq(f,d.text);is(d.linewise);eqPos(a,b.getCursor())});testVim("cw_repeat",function(b,c,e){var a=makeCursor(0,1);b.setCursor(a);e.doKeys("c","2","w");eq(" ",b.getValue());var d=e.getRegisterController().getRegister();eq("word1\nword2",d.text);is(!d.linewise);eqPos(a,b.getCursor());eq("vim-insert",b.getOption("keyMap"))},{value:" word1\nword2"});testVim("cc_multiply_repeat",function(a,b,d){a.setCursor(0,3);var e=a.getRange({line:0,ch:0},{line:6,ch:0});var f=a.lineCount()-5;d.doKeys("2","c","3","c");eq(f,a.lineCount());var c=d.getRegisterController().getRegister();eq(e,c.text);is(c.linewise);d.assertCursorAt(0,lines[0].textStart);eq("vim-insert",a.getOption("keyMap"))});testVim("g~w_repeat",function(b,c,e){var a=makeCursor(0,1);b.setCursor(a);e.doKeys("g","~","2","w");eq(" WORD1\nWORD2",b.getValue());var d=e.getRegisterController().getRegister();eq("",d.text);is(!d.linewise);eqPos(a,b.getCursor())},{value:" word1\nword2"});testVim("g~g~",function(b,d,f){var a=makeCursor(0,3);b.setCursor(a);var g=b.lineCount();var c=b.getValue().toUpperCase();f.doKeys("2","g","~","3","g","~");eq(c,b.getValue());var e=f.getRegisterController().getRegister();eq("",e.text);is(!e.linewise);eqPos(a,b.getCursor())},{value:" word1\nword2\nword3\nword4\nword5\nword6"});testVim(">{motion}",function(a,c,e){a.setCursor(1,3);var f=a.lineCount();var b="   word1\n  word2\nword3 ";e.doKeys(">","k");eq(b,a.getValue());var d=e.getRegisterController().getRegister();eq("",d.text);is(!d.linewise);e.assertCursorAt(0,3)},{value:" word1\nword2\nword3 ",indentUnit:2});testVim(">>",function(a,c,e){a.setCursor(0,3);var f=a.lineCount();var b="   word1\n  word2\nword3 ";e.doKeys("2",">",">");eq(b,a.getValue());var d=e.getRegisterController().getRegister();eq("",d.text);is(!d.linewise);e.assertCursorAt(0,3)},{value:" word1\nword2\nword3 ",indentUnit:2});testVim("<{motion}",function(a,c,e){a.setCursor(1,3);var f=a.lineCount();var b=" word1\nword2\nword3 ";e.doKeys("<","k");eq(b,a.getValue());var d=e.getRegisterController().getRegister();eq("",d.text);is(!d.linewise);e.assertCursorAt(0,1)},{value:"   word1\n  word2\nword3 ",indentUnit:2});testVim("<<",function(a,c,e){a.setCursor(0,3);var f=a.lineCount();var b=" word1\nword2\nword3 ";e.doKeys("2","<","<");eq(b,a.getValue());var d=e.getRegisterController().getRegister();eq("",d.text);is(!d.linewise);e.assertCursorAt(0,1)},{value:"   word1\n  word2\nword3 ",indentUnit:2});testVim("D",function(b,c,e){var a=makeCursor(0,3);b.setCursor(a);e.doKeys("D");eq(" wo\nword2\n word3",b.getValue());var d=e.getRegisterController().getRegister();eq("rd1",d.text);is(!d.linewise);e.assertCursorAt(0,3)},{value:" word1\nword2\n word3"});testVim("C",function(b,c,e){var a=makeCursor(0,3);b.setCursor(a);e.doKeys("C");eq(" wo\nword2\n word3",b.getValue());var d=e.getRegisterController().getRegister();eq("rd1",d.text);is(!d.linewise);e.assertCursorAt(0,3);eq("vim-insert",b.getOption("keyMap"))},{value:" word1\nword2\n word3"});testVim("Y",function(b,c,e){var a=makeCursor(0,3);b.setCursor(a);e.doKeys("Y");eq(" word1\nword2\n word3",b.getValue());var d=e.getRegisterController().getRegister();eq("rd1",d.text);is(!d.linewise);e.assertCursorAt(0,3)},{value:" word1\nword2\n word3"});testVim("ctrl-a",function(a,b,c){a.setCursor(0,0);c.doKeys("Ctrl-a");eq("-9",a.getValue());c.assertCursorAt(0,1);c.doKeys("2","Ctrl-a");eq("-7",a.getValue())},{value:"-10"});testVim("ctrl-x",function(a,b,c){a.setCursor(0,0);c.doKeys("Ctrl-x");eq("-1",a.getValue());c.assertCursorAt(0,1);c.doKeys("2","Ctrl-x");eq("-3",a.getValue())},{value:"0"});testVim("Ctrl-x/Ctrl-a search forward",function(a,b,c){["Ctrl-x","Ctrl-a"].forEach(function(d){a.setCursor(0,0);c.doKeys(d);c.assertCursorAt(0,5);c.doKeys("l");c.doKeys(d);c.assertCursorAt(0,10);a.setCursor(0,11);c.doKeys(d);c.assertCursorAt(0,11)})},{value:"__jmp1 jmp2 jmp"});testVim("a",function(a,b,c){a.setCursor(0,1);c.doKeys("a");c.assertCursorAt(0,2);eq("vim-insert",a.getOption("keyMap"))});testVim("a_eol",function(a,b,c){a.setCursor(0,lines[0].length-1);c.doKeys("a");c.assertCursorAt(0,lines[0].length);eq("vim-insert",a.getOption("keyMap"))});testVim("i",function(a,b,c){a.setCursor(0,1);c.doKeys("i");c.assertCursorAt(0,1);eq("vim-insert",a.getOption("keyMap"))});testVim("A",function(a,b,c){a.setCursor(0,0);c.doKeys("A");c.assertCursorAt(0,lines[0].length);eq("vim-insert",a.getOption("keyMap"))});testVim("I",function(a,b,c){a.setCursor(0,4);c.doKeys("I");c.assertCursorAt(0,lines[0].textStart);eq("vim-insert",a.getOption("keyMap"))});testVim("o",function(a,b,c){a.setCursor(0,4);c.doKeys("o");eq("word1\n\nword2",a.getValue());c.assertCursorAt(1,0);eq("vim-insert",a.getOption("keyMap"))},{value:"word1\nword2"});testVim("O",function(a,b,c){a.setCursor(0,4);c.doKeys("O");eq("\nword1\nword2",a.getValue());c.assertCursorAt(0,0);eq("vim-insert",a.getOption("keyMap"))},{value:"word1\nword2"});testVim("J",function(a,c,d){a.setCursor(0,4);d.doKeys("J");var b="word1  word2\nword3\n word4";eq(b,a.getValue());d.assertCursorAt(0,b.indexOf("word2")-1)},{value:"word1 \n    word2\nword3\n word4"});testVim("J_repeat",function(a,c,d){a.setCursor(0,4);d.doKeys("3","J");var b="word1  word2 word3\n word4";eq(b,a.getValue());d.assertCursorAt(0,b.indexOf("word3")-1)},{value:"word1 \n    word2\nword3\n word4"});testVim("p",function(a,b,c){a.setCursor(0,1);c.getRegisterController().pushText('"',"yank","abc\ndef",false);c.doKeys("p");eq("__abc\ndef_",a.getValue());c.assertCursorAt(1,2)},{value:"___"});testVim("p_register",function(a,b,c){a.setCursor(0,1);c.getRegisterController().getRegister("a").set("abc\ndef",false);c.doKeys('"',"a","p");eq("__abc\ndef_",a.getValue());c.assertCursorAt(1,2)},{value:"___"});testVim("p_wrong_register",function(a,b,c){a.setCursor(0,1);c.getRegisterController().getRegister("a").set("abc\ndef",false);c.doKeys("p");eq("___",a.getValue());c.assertCursorAt(0,1)},{value:"___"});testVim("p_line",function(a,b,c){a.setCursor(0,1);c.getRegisterController().pushText('"',"yank","  a\nd\n",true);c.doKeys("2","p");eq("___\n  a\nd\n  a\nd",a.getValue());c.assertCursorAt(1,2)},{value:"___"});testVim("P",function(a,b,c){a.setCursor(0,1);c.getRegisterController().pushText('"',"yank","abc\ndef",false);c.doKeys("P");eq("_abc\ndef__",a.getValue());c.assertCursorAt(1,3)},{value:"___"});testVim("P_line",function(a,b,c){a.setCursor(0,1);c.getRegisterController().pushText('"',"yank","  a\nd\n",true);c.doKeys("2","P");eq("  a\nd\n  a\nd\n___",a.getValue());c.assertCursorAt(0,2)},{value:"___"});testVim("r",function(a,b,c){a.setCursor(0,1);c.doKeys("3","r","u");eq("wuuuet\nanother",a.getValue(),"3r failed");c.assertCursorAt(0,3);a.setCursor(0,4);c.doKeys("v","j","h","r","Space");eq("wuuu  \n    her",a.getValue(),"Replacing selection by space-characters failed")},{value:"wordet\nanother"});testVim("mark",function(a,b,c){a.setCursor(2,2);c.doKeys("m","t");a.setCursor(0,0);c.doKeys("'","t");c.assertCursorAt(2,2);a.setCursor(0,0);c.doKeys("`","t");c.assertCursorAt(2,2)});testVim("jumpToMark_next",function(a,b,c){a.setCursor(2,2);c.doKeys("m","t");a.setCursor(0,0);c.doKeys("]","`");c.assertCursorAt(2,2);a.setCursor(0,0);c.doKeys("]","'");c.assertCursorAt(2,0)});testVim("jumpToMark_next_repeat",function(a,b,c){a.setCursor(2,2);c.doKeys("m","a");a.setCursor(3,2);c.doKeys("m","b");a.setCursor(4,2);c.doKeys("m","c");a.setCursor(0,0);c.doKeys("2","]","`");c.assertCursorAt(3,2);a.setCursor(0,0);c.doKeys("2","]","'");c.assertCursorAt(3,1)});testVim("jumpToMark_next_sameline",function(a,b,c){a.setCursor(2,0);c.doKeys("m","a");a.setCursor(2,4);c.doKeys("m","b");a.setCursor(2,2);c.doKeys("]","`");c.assertCursorAt(2,4)});testVim("jumpToMark_next_onlyprev",function(a,b,c){a.setCursor(2,0);c.doKeys("m","a");a.setCursor(4,0);c.doKeys("]","`");c.assertCursorAt(4,0)});testVim("jumpToMark_next_nomark",function(a,b,c){a.setCursor(2,2);c.doKeys("]","`");c.assertCursorAt(2,2);c.doKeys("]","'");c.assertCursorAt(2,0)});testVim("jumpToMark_next_linewise_over",function(a,b,c){a.setCursor(2,2);c.doKeys("m","a");a.setCursor(3,4);c.doKeys("m","b");a.setCursor(2,1);c.doKeys("]","'");c.assertCursorAt(3,1)});testVim("jumpToMark_next_action",function(a,b,d){a.setCursor(2,2);d.doKeys("m","t");a.setCursor(0,0);d.doKeys("d","]","`");d.assertCursorAt(0,0);var e=a.getLine(0);var c="pop pop 0 1 2 3 4";eq(e,c,"Deleting while jumping to the next mark failed.")});testVim("jumpToMark_next_line_action",function(a,b,d){a.setCursor(2,2);d.doKeys("m","t");a.setCursor(0,0);d.doKeys("d","]","'");d.assertCursorAt(0,1);var e=a.getLine(0);var c=" (a) [b] {c} ";eq(e,c,"Deleting while jumping to the next mark line failed.")});testVim("jumpToMark_prev",function(a,b,c){a.setCursor(2,2);c.doKeys("m","t");a.setCursor(4,0);c.doKeys("[","`");c.assertCursorAt(2,2);a.setCursor(4,0);c.doKeys("[","'");c.assertCursorAt(2,0)});testVim("jumpToMark_prev_repeat",function(a,b,c){a.setCursor(2,2);c.doKeys("m","a");a.setCursor(3,2);c.doKeys("m","b");a.setCursor(4,2);c.doKeys("m","c");a.setCursor(5,0);c.doKeys("2","[","`");c.assertCursorAt(3,2);a.setCursor(5,0);c.doKeys("2","[","'");c.assertCursorAt(3,1)});testVim("jumpToMark_prev_sameline",function(a,b,c){a.setCursor(2,0);c.doKeys("m","a");a.setCursor(2,4);c.doKeys("m","b");a.setCursor(2,2);c.doKeys("[","`");c.assertCursorAt(2,0)});testVim("jumpToMark_prev_onlynext",function(a,b,c){a.setCursor(4,4);c.doKeys("m","a");a.setCursor(2,0);c.doKeys("[","`");c.assertCursorAt(2,0)});testVim("jumpToMark_prev_nomark",function(a,b,c){a.setCursor(2,2);c.doKeys("[","`");c.assertCursorAt(2,2);c.doKeys("[","'");c.assertCursorAt(2,0)});testVim("jumpToMark_prev_linewise_over",function(a,b,c){a.setCursor(2,2);c.doKeys("m","a");a.setCursor(3,4);c.doKeys("m","b");a.setCursor(3,6);c.doKeys("[","'");c.assertCursorAt(2,0)});testVim("delmark_single",function(a,b,c){a.setCursor(1,2);c.doKeys("m","t");c.doEx("delmarks t");a.setCursor(0,0);c.doKeys("`","t");c.assertCursorAt(0,0)});testVim("delmark_range",function(a,b,c){a.setCursor(1,2);c.doKeys("m","a");a.setCursor(2,2);c.doKeys("m","b");a.setCursor(3,2);c.doKeys("m","c");a.setCursor(4,2);c.doKeys("m","d");a.setCursor(5,2);c.doKeys("m","e");c.doEx("delmarks b-d");a.setCursor(0,0);c.doKeys("`","a");c.assertCursorAt(1,2);c.doKeys("`","b");c.assertCursorAt(1,2);c.doKeys("`","c");c.assertCursorAt(1,2);c.doKeys("`","d");c.assertCursorAt(1,2);c.doKeys("`","e");c.assertCursorAt(5,2)});testVim("delmark_multi",function(a,b,c){a.setCursor(1,2);c.doKeys("m","a");a.setCursor(2,2);c.doKeys("m","b");a.setCursor(3,2);c.doKeys("m","c");a.setCursor(4,2);c.doKeys("m","d");a.setCursor(5,2);c.doKeys("m","e");c.doEx("delmarks bcd");a.setCursor(0,0);c.doKeys("`","a");c.assertCursorAt(1,2);c.doKeys("`","b");c.assertCursorAt(1,2);c.doKeys("`","c");c.assertCursorAt(1,2);c.doKeys("`","d");c.assertCursorAt(1,2);c.doKeys("`","e");c.assertCursorAt(5,2)});testVim("delmark_multi_space",function(a,b,c){a.setCursor(1,2);c.doKeys("m","a");a.setCursor(2,2);c.doKeys("m","b");a.setCursor(3,2);c.doKeys("m","c");a.setCursor(4,2);c.doKeys("m","d");a.setCursor(5,2);c.doKeys("m","e");c.doEx("delmarks b c d");a.setCursor(0,0);c.doKeys("`","a");c.assertCursorAt(1,2);c.doKeys("`","b");c.assertCursorAt(1,2);c.doKeys("`","c");c.assertCursorAt(1,2);c.doKeys("`","d");c.assertCursorAt(1,2);c.doKeys("`","e");c.assertCursorAt(5,2)});testVim("delmark_all",function(a,b,c){a.setCursor(1,2);c.doKeys("m","a");a.setCursor(2,2);c.doKeys("m","b");a.setCursor(3,2);c.doKeys("m","c");a.setCursor(4,2);c.doKeys("m","d");a.setCursor(5,2);c.doKeys("m","e");c.doEx("delmarks a b-de");a.setCursor(0,0);c.doKeys("`","a");c.assertCursorAt(0,0);c.doKeys("`","b");c.assertCursorAt(0,0);c.doKeys("`","c");c.assertCursorAt(0,0);c.doKeys("`","d");c.assertCursorAt(0,0);c.doKeys("`","e");c.assertCursorAt(0,0)});testVim("visual",function(a,b,c){c.doKeys("l","v","l","l");c.assertCursorAt(0,3);eqPos(makeCursor(0,1),a.getCursor("anchor"));c.doKeys("d");eq("15",a.getValue())},{value:"12345"});testVim("visual_line",function(a,b,c){c.doKeys("l","V","l","j","j","d");eq(" 4\n 5",a.getValue())},{value:" 1\n 2\n 3\n 4\n 5"});testVim("visual_marks",function(a,b,c){c.doKeys("l","v","l","l","v");a.setCursor(0,0);c.doKeys("'","<");c.assertCursorAt(0,1);c.doKeys("'",">");c.assertCursorAt(0,3)});testVim("visual_join",function(a,b,c){c.doKeys("l","V","l","j","j","J");eq(" 1 2 3\n 4\n 5",a.getValue())},{value:" 1\n 2\n 3\n 4\n 5"});testVim("/ and n/N",function(a,b,c){a.openDialog=c.fakeOpenDialog("match");c.doKeys("/");c.assertCursorAt(0,11);c.doKeys("n");c.assertCursorAt(1,6);c.doKeys("N");c.assertCursorAt(0,11);a.setCursor(0,0);c.doKeys("2","/");c.assertCursorAt(1,6)},{value:"match nope match \n nope Match"});testVim("/_case",function(a,b,c){a.openDialog=c.fakeOpenDialog("Match");c.doKeys("/");c.assertCursorAt(1,6)},{value:"match nope match \n nope Match"});testVim("? and n/N",function(a,b,c){a.openDialog=c.fakeOpenDialog("match");c.doKeys("?");c.assertCursorAt(1,6);c.doKeys("n");c.assertCursorAt(0,11);c.doKeys("N");c.assertCursorAt(1,6);a.setCursor(0,0);c.doKeys("2","?");c.assertCursorAt(0,11)},{value:"match nope match \n nope Match"});testVim("*",function(a,b,c){a.setCursor(0,9);c.doKeys("*");c.assertCursorAt(0,22);a.setCursor(0,9);c.doKeys("2","*");c.assertCursorAt(1,8)},{value:"nomatch match nomatch match \nnomatch Match"});testVim("*_no_word",function(a,b,c){a.setCursor(0,0);c.doKeys("*");c.assertCursorAt(0,0)},{value:" \n match \n"});testVim("*_symbol",function(a,b,c){a.setCursor(0,0);c.doKeys("*");c.assertCursorAt(1,0)},{value:" /}\n/} match \n"});testVim("#",function(a,b,c){a.setCursor(0,9);c.doKeys("#");c.assertCursorAt(1,8);a.setCursor(0,9);c.doKeys("2","#");c.assertCursorAt(0,22)},{value:"nomatch match nomatch match \nnomatch Match"});testVim("*_seek",function(a,b,c){a.setCursor(0,3);c.doKeys("*");c.assertCursorAt(0,22)},{value:"    :=  match nomatch match \nnomatch Match"});testVim("#",function(a,b,c){a.setCursor(0,3);c.doKeys("#");c.assertCursorAt(1,8)},{value:"    :=  match nomatch match \nnomatch Match"});testVim(".",function(a,b,c){a.setCursor(0,0);c.doKeys("2","d","w");c.doKeys(".");eq("5 6",a.getValue())},{value:"1 2 3 4 5 6"});testVim("._repeat",function(a,b,c){a.setCursor(0,0);c.doKeys("2","d","w");c.doKeys("3",".");eq("6",a.getValue())},{value:"1 2 3 4 5 6"});testVim("f;",function(a,b,c){a.setCursor(0,0);c.doKeys("f","x");c.doKeys(";");c.doKeys("2",";");eq(9,a.getCursor().ch)},{value:"01x3xx678x"});testVim("F;",function(a,b,c){a.setCursor(0,8);c.doKeys("F","x");c.doKeys(";");c.doKeys("2",";");eq(2,a.getCursor().ch)},{value:"01x3xx6x8x"});testVim("t;",function(a,b,c){a.setCursor(0,0);c.doKeys("t","x");c.doKeys(";");c.doKeys("2",";");eq(8,a.getCursor().ch)},{value:"01x3xx678x"});testVim("T;",function(a,b,c){a.setCursor(0,9);c.doKeys("T","x");c.doKeys(";");c.doKeys("2",";");eq(2,a.getCursor().ch)},{value:"0xx3xx678x"});testVim("f,",function(a,b,c){a.setCursor(0,6);c.doKeys("f","x");c.doKeys(",");c.doKeys("2",",");eq(2,a.getCursor().ch)},{value:"01x3xx678x"});testVim("F,",function(a,b,c){a.setCursor(0,3);c.doKeys("F","x");c.doKeys(",");c.doKeys("2",",");eq(9,a.getCursor().ch)},{value:"01x3xx678x"});testVim("t,",function(a,b,c){a.setCursor(0,6);c.doKeys("t","x");c.doKeys(",");c.doKeys("2",",");eq(3,a.getCursor().ch)},{value:"01x3xx678x"});testVim("T,",function(a,b,c){a.setCursor(0,4);c.doKeys("T","x");c.doKeys(",");c.doKeys("2",",");eq(8,a.getCursor().ch)},{value:"01x3xx67xx"});testVim("fd,;",function(a,b,c){a.setCursor(0,0);c.doKeys("f","4");a.setCursor(0,0);c.doKeys("d",";");eq("56789",a.getValue());c.doKeys("u");a.setCursor(0,9);c.doKeys("d",",");eq("01239",a.getValue())},{value:"0123456789"});testVim("Fd,;",function(a,b,c){a.setCursor(0,9);c.doKeys("F","4");a.setCursor(0,9);c.doKeys("d",";");eq("01239",a.getValue());c.doKeys("u");a.setCursor(0,0);c.doKeys("d",",");eq("56789",a.getValue())},{value:"0123456789"});testVim("td,;",function(a,b,c){a.setCursor(0,0);c.doKeys("t","4");a.setCursor(0,0);c.doKeys("d",";");eq("456789",a.getValue());c.doKeys("u");a.setCursor(0,9);c.doKeys("d",",");eq("012349",a.getValue())},{value:"0123456789"});testVim("Td,;",function(a,b,c){a.setCursor(0,9);c.doKeys("T","4");a.setCursor(0,9);c.doKeys("d",";");eq("012349",a.getValue());c.doKeys("u");a.setCursor(0,0);c.doKeys("d",",");eq("456789",a.getValue())},{value:"0123456789"});testVim("fc,;",function(a,b,c){a.setCursor(0,0);c.doKeys("f","4");a.setCursor(0,0);c.doKeys("c",";","Esc");eq("56789",a.getValue());c.doKeys("u");a.setCursor(0,9);c.doKeys("c",",");eq("01239",a.getValue())},{value:"0123456789"});testVim("Fc,;",function(a,b,c){a.setCursor(0,9);c.doKeys("F","4");a.setCursor(0,9);c.doKeys("c",";","Esc");eq("01239",a.getValue());c.doKeys("u");a.setCursor(0,0);c.doKeys("c",",");eq("56789",a.getValue())},{value:"0123456789"});testVim("tc,;",function(a,b,c){a.setCursor(0,0);c.doKeys("t","4");a.setCursor(0,0);c.doKeys("c",";","Esc");eq("456789",a.getValue());c.doKeys("u");a.setCursor(0,9);c.doKeys("c",",");eq("012349",a.getValue())},{value:"0123456789"});testVim("Tc,;",function(a,b,c){a.setCursor(0,9);c.doKeys("T","4");a.setCursor(0,9);c.doKeys("c",";","Esc");eq("012349",a.getValue());c.doKeys("u");a.setCursor(0,0);c.doKeys("c",",");eq("456789",a.getValue())},{value:"0123456789"});testVim("fy,;",function(a,b,c){a.setCursor(0,0);c.doKeys("f","4");a.setCursor(0,0);c.doKeys("y",";","P");eq("012340123456789",a.getValue());c.doKeys("u");a.setCursor(0,9);c.doKeys("y",",","P");eq("012345678456789",a.getValue())},{value:"0123456789"});testVim("Fy,;",function(a,b,c){a.setCursor(0,9);c.doKeys("F","4");a.setCursor(0,9);c.doKeys("y",";","p");eq("012345678945678",a.getValue());c.doKeys("u");a.setCursor(0,0);c.doKeys("y",",","P");eq("012340123456789",a.getValue())},{value:"0123456789"});testVim("ty,;",function(a,b,c){a.setCursor(0,0);c.doKeys("t","4");a.setCursor(0,0);c.doKeys("y",";","P");eq("01230123456789",a.getValue());c.doKeys("u");a.setCursor(0,9);c.doKeys("y",",","p");eq("01234567895678",a.getValue())},{value:"0123456789"});testVim("Ty,;",function(a,b,c){a.setCursor(0,9);c.doKeys("T","4");a.setCursor(0,9);c.doKeys("y",";","p");eq("01234567895678",a.getValue());c.doKeys("u");a.setCursor(0,0);c.doKeys("y",",","P");eq("01230123456789",a.getValue())},{value:"0123456789"});testVim("HML",function(a,b,c){a.setSize(600,400);a.setCursor(120,0);c.doKeys("H");c.assertCursorAt(90,2);c.doKeys("L");c.assertCursorAt(119,4);c.doKeys("M");c.assertCursorAt(104,4)},{value:(function(){var b=new Array(100);var d=new Array(100);var c="  xx\n";var a="    xx\n";c=b.join(c);a=b.join(a);return c+a})()});var squareBracketMotionSandbox="({\n  ({\n  /*comment {\n            */(\n#else                \n  /*       )\n#if        }\n  )}*/\n)}\n{}\n#else {{\n{}\n}\n{\n#endif\n}\n}\n#else";testVim("[[, ]]",function(a,b,c){a.setCursor(0,0);c.doKeys("]","]");c.assertCursorAt(9,0);c.doKeys("2","]","]");c.assertCursorAt(13,0);c.doKeys("]","]");c.assertCursorAt(17,0);c.doKeys("[","[");c.assertCursorAt(13,0);c.doKeys("2","[","[");c.assertCursorAt(9,0);c.doKeys("[","[");c.assertCursorAt(0,0)},{value:squareBracketMotionSandbox});testVim("[], ][",function(a,b,c){a.setCursor(0,0);c.doKeys("]","[");c.assertCursorAt(12,0);c.doKeys("2","]","[");c.assertCursorAt(16,0);c.doKeys("]","[");c.assertCursorAt(17,0);c.doKeys("[","]");c.assertCursorAt(16,0);c.doKeys("2","[","]");c.assertCursorAt(12,0);c.doKeys("[","]");c.assertCursorAt(0,0)},{value:squareBracketMotionSandbox});testVim("[{, ]}",function(a,b,c){a.setCursor(4,10);c.doKeys("[","{");c.assertCursorAt(2,12);c.doKeys("2","[","{");c.assertCursorAt(0,1);a.setCursor(4,10);c.doKeys("]","}");c.assertCursorAt(6,11);c.doKeys("2","]","}");c.assertCursorAt(8,1);a.setCursor(0,1);c.doKeys("]","}");c.assertCursorAt(8,1);c.doKeys("[","{");c.assertCursorAt(0,1)},{value:squareBracketMotionSandbox});testVim("[(, ])",function(a,b,c){a.setCursor(4,10);c.doKeys("[","(");c.assertCursorAt(3,14);c.doKeys("2","[","(");c.assertCursorAt(0,0);a.setCursor(4,10);c.doKeys("]",")");c.assertCursorAt(5,11);c.doKeys("2","]",")");c.assertCursorAt(8,0);c.doKeys("[","(");c.assertCursorAt(0,0);c.doKeys("]",")");c.assertCursorAt(8,0)},{value:squareBracketMotionSandbox});testVim("[*, ]*, [/, ]/",function(a,b,c){["*","/"].forEach(function(d){a.setCursor(7,0);c.doKeys("2","[",d);c.assertCursorAt(2,2);c.doKeys("2","]",d);c.assertCursorAt(7,5)})},{value:squareBracketMotionSandbox});testVim("[#, ]#",function(a,b,c){a.setCursor(10,3);c.doKeys("2","[","#");c.assertCursorAt(4,0);c.doKeys("5","]","#");c.assertCursorAt(17,0);a.setCursor(10,3);c.doKeys("]","#");c.assertCursorAt(14,0)},{value:squareBracketMotionSandbox});testVim("[m, ]m, [M, ]M",function(a,b,c){a.setCursor(11,0);c.doKeys("[","m");c.assertCursorAt(10,7);c.doKeys("4","[","m");c.assertCursorAt(1,3);c.doKeys("5","]","m");c.assertCursorAt(11,0);c.doKeys("[","M");c.assertCursorAt(9,1);c.doKeys("3","]","M");c.assertCursorAt(15,0);c.doKeys("5","[","M");c.assertCursorAt(7,3)},{value:squareBracketMotionSandbox});testVim("ex_go_to_line",function(a,b,c){a.setCursor(0,0);c.doEx("4");c.assertCursorAt(3,0)},{value:"a\nb\nc\nd\ne\n"});testVim("ex_write",function(a,d,g){var f=CodeMirror.commands.save;var c;var b;CodeMirror.commands.save=function(i){c=true;b=i};var h="write";for(var e=1;e<h.length;e++){c=false;b=null;g.doEx(h.substring(0,e));eq(c,true);eq(b,a)}CodeMirror.commands.save=f});testVim("ex_substitute_same_line",function(a,b,c){a.setCursor(1,0);c.doEx("s/one/two");eq("one one\n two two",a.getValue())},{value:"one one\n one one"});testVim("ex_substitute_global",function(a,b,c){a.setCursor(1,0);c.doEx("%s/one/two");eq("two two\n two two",a.getValue())},{value:"one one\n one one"});testVim("ex_substitute_input_range",function(a,b,c){a.setCursor(1,0);c.doEx("1,3s/\\d/0");eq("0\n0\n0\n4",a.getValue())},{value:"1\n2\n3\n4"});testVim("ex_substitute_visual_range",function(a,b,c){a.setCursor(1,0);c.doKeys("V","2","j","v");c.doEx("'<,'>s/\\d/0");eq("1\n0\n0\n0\n5",a.getValue())},{value:"1\n2\n3\n4\n5"});testVim("ex_substitute_capture",function(a,b,c){a.setCursor(1,0);c.doEx("s/(\\d+)/$1$1/");eq("a1111 a1212 a1313",a.getValue())},{value:"a11 a12 a13"});testVim("ex_substitute_empty_query",function(a,b,c){a.setCursor(1,0);a.openDialog=c.fakeOpenDialog("1");c.doKeys("/");c.doEx("s//b");eq("abb ab2 ab3",a.getValue())},{value:"a11 a12 a13"});testVim("ex_substitute_count",function(a,b,c){a.setCursor(1,0);c.doEx("s/\\d/0/i 2");eq("1\n0\n0\n4",a.getValue())},{value:"1\n2\n3\n4"});testVim("ex_substitute_count_with_range",function(a,b,c){a.setCursor(1,0);c.doEx("1,3s/\\d/0/ 3");eq("1\n2\n0\n0",a.getValue())},{value:"1\n2\n3\n4"});testVim("ex_noh_clearSearchHighlight",function(a,b,c){a.openDialog=c.fakeOpenDialog("match");c.doKeys("?");c.doEx("noh");eq(b.searchState_.getOverlay(),null,"match-highlighting wasn't cleared");c.doKeys("n");c.assertCursorAt(0,11,"can't resume search after clearing highlighting")},{value:"match nope match \n nope Match"});testVim("ex_map_key2key",function(a,b,c){c.doEx("map a x");c.doKeys("a");c.assertCursorAt(0,0);eq("bc",a.getValue())},{value:"abc"});testVim("ex_map_key2key_to_colon",function(a,c,d){d.doEx("map ; :");var b=false;a.openDialog=function(){b=true};d.doKeys(";");eq(b,true)});testVim("ex_map_ex2key:",function(a,b,c){c.doEx("map :del x");c.doEx("del");c.assertCursorAt(0,0);eq("bc",a.getValue())},{value:"abc"});testVim("ex_map_ex2ex",function(a,d,f){f.doEx("map :del :w");var e=CodeMirror.commands.save;var c=false;var b;CodeMirror.commands.save=function(g){c=true;b=g};f.doEx("del");CodeMirror.commands.save=e;eq(c,true);eq(b,a)});testVim("ex_map_key2ex",function(a,d,f){f.doEx("map a :w");var e=CodeMirror.commands.save;var c=false;var b;CodeMirror.commands.save=function(g){c=true;b=g};f.doKeys("a");CodeMirror.commands.save=e;eq(c,true);eq(b,a)});testVim("ex_api_test",function(a,b,d){var c=false;var e="from";CodeMirror.Vim.defineEx("extest","ext",function(f,g){if(g.args){e=g.args[0]}else{c=true}});d.doEx(":ext to");eq(e,"to","Defining ex-command failed");CodeMirror.Vim.map("<C-CR><Space>",":ext");d.doKeys("Ctrl-Enter","Space");is(c,"Mapping to key failed")});testVim("ex_map_key2key_from_colon",function(a,b,c){c.doEx("map : x");c.doKeys(":");c.assertCursorAt(0,0);eq("bc",a.getValue())},{value:"abc"});
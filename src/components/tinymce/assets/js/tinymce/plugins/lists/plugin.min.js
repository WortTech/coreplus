// plugin.js
tinymce.PluginManager.add("lists",function(a){var b=this;a.on("init",function(){var p=a.dom,u=a.selection;function i(v){var w={};function x(B){var z,y,A;y=v[B?"startContainer":"endContainer"];A=v[B?"startOffset":"endOffset"];if(y.nodeType==1){z=p.create("span",{"data-mce-type":"bookmark"});if(y.hasChildNodes()){A=Math.min(A,y.childNodes.length-1);y.insertBefore(z,y.childNodes[A])}else{y.appendChild(z)}y=z;A=0}w[B?"startContainer":"endContainer"]=y;w[B?"startOffset":"endOffset"]=A}x(true);x();return w}function f(w){function x(C){var y,A,z;function B(E){var F=E.parentNode.firstChild,D=0;while(F){if(F==E){return D}if(F.nodeType!=1||F.getAttribute("data-mce-type")!="bookmark"){D++}F=F.nextSibling}return -1}y=z=w[C?"startContainer":"endContainer"];A=w[C?"startOffset":"endOffset"];if(y.nodeType==1){if(C){A=B(y);y=y.parentNode}else{A=B(y);y=y.parentNode}p.remove(z)}w[C?"startContainer":"endContainer"]=y;w[C?"startOffset":"endOffset"]=A}x(true);x();var v=p.createRng();v.setStart(w.startContainer,w.startOffset);v.setEnd(w.endContainer,w.endOffset);u.setRng(v)}function d(v){return v&&(/^(OL|UL)$/).test(v.nodeName)}function l(v){return v.parentNode.firstChild==v}function m(v){return v.parentNode.lastChild==v}function n(v){return v&&!!a.schema.getTextBlockElements()[v.nodeName]}function e(v,x){var y,w;if(a.settings.forced_root_block){x=x||a.settings.forced_root_block}if(x){w=p.create(x)}else{w=p.createFragment()}if(v){while((y=v.firstChild)){w.appendChild(y)}}if(!a.settings.forced_root_block){w.appendChild(p.create("br"))}if(!w.hasChildNodes()&&!tinymce.isIE){w.innerHTML='<br data-mce-bogus="1">'}return w}function s(){return tinymce.grep(u.getSelectedBlocks(),function(v){return v.nodeName=="LI"})}function c(){return tinymce.grep(u.getSelectedBlocks(),n)}function o(y,v,z){var x,w;z=z||e(v);x=p.createRng();x.setStartAfter(v);x.setEndAfter(y);w=x.extractContents();if(!p.isEmpty(w)){p.insertAfter(w,y)}if(!p.isEmpty(z)){p.insertAfter(z,y)}if(p.isEmpty(v.parentNode)){p.remove(v.parentNode)}p.remove(v)}function t(v){var w,x;w=v.nextSibling;if(w&&d(w)&&w.nodeName==v.nodeName){while((x=w.firstChild)){v.appendChild(x)}p.remove(w)}w=v.previousSibling;if(w&&d(w)&&w.nodeName==v.nodeName){while((x=w.firstChild)){v.insertBefore(x,v.firstChild)}p.remove(w)}}function g(v){tinymce.each(tinymce.grep(p.select("ol,ul",v)),function(x){var y,w=x.parentNode;if(w.nodeName=="LI"&&w.firstChild==x){y=w.previousSibling;if(y&&y.nodeName=="LI"){y.appendChild(x);if(p.isEmpty(w)){p.remove(w)}}}if(d(w)){y=w.previousSibling;if(y&&y.nodeName=="LI"){y.appendChild(x)}}})}function j(){var w,v=i(u.getRng(true));tinymce.each(s(),function(x){var z,y;z=x.previousSibling;if(z&&z.nodeName=="UL"){z.appendChild(x);return}if(z&&z.nodeName=="LI"&&d(z.lastChild)){z.lastChild.appendChild(x);return}z=x.nextSibling;if(z&&z.nodeName=="UL"){z.insertBefore(x,z.firstChild);return}if(z&&z.nodeName=="LI"&&d(x.lastChild)){return}z=x.previousSibling;if(z&&z.nodeName=="LI"){y=p.create(x.parentNode.nodeName);z.appendChild(y);y.appendChild(x)}w=true});f(v);return w}function k(){var w,v=i(u.getRng(true));tinymce.each(s(),function(y){var z=y.parentNode,x=z.parentNode,A;if(l(y)&&m(y)){if(x.nodeName=="LI"){p.insertAfter(y,x)}else{if(d(x)){p.remove(z,true)}else{return}}}else{if(l(y)){if(x.nodeName=="LI"){p.insertAfter(y,x);A=p.create("LI");A.appendChild(z);p.insertAfter(A,y)}else{if(d(x)){x.insertBefore(y,z)}else{return}}}else{if(m(y)){if(x.nodeName=="LI"){p.insertAfter(y,x)}else{if(d(x)){p.insertAfter(y,z)}else{return}}}else{if(x.nodeName=="LI"){z=x;A=e(y,"LI")}else{if(d(x)){A=e(y,"LI")}else{return}}o(z,y,A);g(z.parentNode)}}}w=true});f(v);return w}function q(w){var v=u.getRng(true),y=i(v),z=c();function x(){function C(J){var H,I,G=a.getBody();H=v[J?"startContainer":"endContainer"];I=v[J?"startOffset":"endOffset"];if(H.nodeType==1){H=H.childNodes[Math.min(I,H.childNodes.length-1)]||H}while(H.parentNode!=G){if(n(H)){return H}if(/^(TD|TH)$/.test(H.parentNode.nodeName)){return H}H=H.parentNode}return H}function D(H,I){var G,J=[];if(!n(H)){while(H){G=H[I?"previousSibling":"nextSibling"];if(p.isBlock(G)||!G){break}H=G}while(H){J.push(H);H=H[I?"nextSibling":"previousSibling"]}}return J}var B=C(true);var A=C();var F,E;E=D(B,true);if(B!=A){E=E.concat(D(A).reverse())}tinymce.each(E,function(G){if(p.isBlock(G)&&G.nodeName!="BR"){return}if(!F||G.nodeName=="BR"){if(G.nodeName=="BR"){if(!G.nextSibling||(p.isBlock(G.nextSibling)&&G.nextSibling.nodeName!="BR")){p.remove(G);return false}}F=p.create("p");z.push(F);G.parentNode.insertBefore(F,G)}if(G.nodeName!="BR"){F.appendChild(G)}else{p.remove(G)}if(G==A){return false}})}x();tinymce.each(z,function(C){var A,B;B=C.previousSibling;if(B&&d(B)&&B.nodeName==w){A=B;C=p.rename(C,"LI");B.appendChild(C)}else{A=p.create(w);C.parentNode.insertBefore(A,C);A.appendChild(C);C=p.rename(C,"LI")}t(A)});f(y)}function r(){var v=i(u.getRng(true));tinymce.each(s(),function(w){var y,x;for(y=w;y;y=y.parentNode){if(d(y)){x=y}}o(x,w)});f(v)}function h(w){var v=p.getParent(u.getStart(),"OL,UL");if(v){if(v.nodeName==w){r(w)}else{var x=i(u.getRng(true));t(p.rename(v,w));f(x)}}else{q(w)}}b.backspaceDelete=function(z){function A(C,E){var D=C.startContainer,G=C.startOffset;if(D.nodeType==3&&(E?G<D.data.length:G>0)){return D}var F=new tinymce.dom.TreeWalker(C.startContainer);while((D=F[E?"next":"prev"]())){if(D.nodeType==3&&D.data.length>0){return D}}}function B(D,G){var F,E,C=D.parentNode;if(d(G.lastChild)){E=G.lastChild}F=G.lastChild;if(F&&F.nodeName=="BR"&&D.hasChildNodes()){p.remove(F)}while((F=D.firstChild)){G.appendChild(F)}if(E){G.appendChild(E)}p.remove(D);if(p.isEmpty(C)){p.remove(C)}}if(u.isCollapsed()){var v=p.getParent(u.getStart(),"LI");if(v){var x=u.getRng(true);var w=p.getParent(A(x,z),"LI");if(w&&w!=v){var y=i(x);if(z){B(w,v)}else{B(v,w)}f(y);return true}else{if(!w){if(!z&&r(v.parentNode.nodeName)){return true}}}}}};a.addCommand("Indent",function(){if(!j()){return true}});a.addCommand("Outdent",function(){if(!k()){return true}});a.addCommand("InsertUnorderedList",function(){h("UL")});a.addCommand("InsertOrderedList",function(){h("OL")})});a.on("keydown",function(c){if(c.keyCode==tinymce.util.VK.BACKSPACE){if(b.backspaceDelete()){c.preventDefault()}}else{if(c.keyCode==tinymce.util.VK.DELETE){if(b.backspaceDelete(true)){c.preventDefault()}}}})});
// plugin.js
tinymce.PluginManager.add("lists",function(d){var a=this;function b(g){return g&&(/^(OL|UL|DL)$/).test(g.nodeName)}function c(g){return g.parentNode.firstChild==g}function f(g){return g.parentNode.lastChild==g}function e(g){return g&&!!d.schema.getTextBlockElements()[g.nodeName]}d.on("init",function(){var n=d.dom,v=d.selection;function u(x){var y={};function z(D){var B,A,C;A=x[D?"startContainer":"endContainer"];C=x[D?"startOffset":"endOffset"];if(A.nodeType==1){B=n.create("span",{"data-mce-type":"bookmark"});if(A.hasChildNodes()){C=Math.min(C,A.childNodes.length-1);if(D){A.insertBefore(B,A.childNodes[C])}else{n.insertAfter(B,A.childNodes[C])}}else{A.appendChild(B)}A=B;C=0}y[D?"startContainer":"endContainer"]=A;y[D?"startOffset":"endOffset"]=C}z(true);if(!x.collapsed){z()}return y}function t(y){function z(E){var A,C,B;function D(G){var H=G.parentNode.firstChild,F=0;while(H){if(H==G){return F}if(H.nodeType!=1||H.getAttribute("data-mce-type")!="bookmark"){F++}H=H.nextSibling}return -1}A=B=y[E?"startContainer":"endContainer"];C=y[E?"startOffset":"endOffset"];if(!A){return}if(A.nodeType==1){C=D(A);A=A.parentNode;n.remove(B)}y[E?"startContainer":"endContainer"]=A;y[E?"startOffset":"endOffset"]=C}z(true);z();var x=n.createRng();x.setStart(y.startContainer,y.startOffset);if(y.endContainer){x.setEnd(y.endContainer,y.endOffset)}v.setRng(x)}function k(x,B){var D,y,A=n.createFragment(),z;var C=d.schema.getBlockElements();if(d.settings.forced_root_block){B=B||d.settings.forced_root_block}if(B){y=n.create(B);if(y.tagName===d.settings.forced_root_block){n.setAttribs(y,d.settings.forced_root_block_attrs)}A.appendChild(y)}if(x){while((D=x.firstChild)){var E=D.nodeName;if(!z&&(E!="SPAN"||D.getAttribute("data-mce-type")!="bookmark")){z=true}if(C[E]){A.appendChild(D);y=null}else{if(B){if(!y){y=n.create(B);A.appendChild(y)}y.appendChild(D)}else{A.appendChild(D)}}}}if(!d.settings.forced_root_block){A.appendChild(n.create("br"))}else{if(!z&&(!tinymce.Env.ie||tinymce.Env.ie>10)){y.appendChild(n.create("br",{"data-mce-bogus":"1"}))}}return A}function p(){return tinymce.grep(v.getSelectedBlocks(),function(x){return/^(LI|DT|DD)$/.test(x.nodeName)})}function o(A,x,E){var z,y,B,C;function D(F){tinymce.each(B,function(G){F.parentNode.insertBefore(G,x.parentNode)});n.remove(F)}B=n.select('span[data-mce-type="bookmark"]',A);E=E||k(x);z=n.createRng();z.setStartAfter(x);z.setEndAfter(A);y=z.extractContents();for(C=y.firstChild;C;C=C.firstChild){if(C.nodeName=="LI"&&n.isEmpty(C)){n.remove(C);break}}if(!n.isEmpty(y)){n.insertAfter(y,A)}n.insertAfter(E,A);if(n.isEmpty(x.parentNode)){D(x.parentNode)}n.remove(x);if(n.isEmpty(A)){n.remove(A)}}function w(x){var y,z;y=x.nextSibling;if(y&&b(y)&&y.nodeName==x.nodeName){while((z=y.firstChild)){x.appendChild(z)}n.remove(y)}y=x.previousSibling;if(y&&b(y)&&y.nodeName==x.nodeName){while((z=y.firstChild)){x.insertBefore(z,x.firstChild)}n.remove(y)}}function g(x){tinymce.each(tinymce.grep(n.select("ol,ul",x)),function(z){var A,y=z.parentNode;if(y.nodeName=="LI"&&y.firstChild==z){A=y.previousSibling;if(A&&A.nodeName=="LI"){A.appendChild(z);if(n.isEmpty(y)){n.remove(y)}}}if(b(y)){A=y.previousSibling;if(A&&A.nodeName=="LI"){A.appendChild(z)}}})}function s(y){var z=y.parentNode,x=z.parentNode,B;function A(C){if(n.isEmpty(C)){n.remove(C)}}if(y.nodeName=="DD"){n.rename(y,"DT");return true}if(c(y)&&f(y)){if(x.nodeName=="LI"){n.insertAfter(y,x);A(x);n.remove(z)}else{if(b(x)){n.remove(z,true)}else{x.insertBefore(k(y),z);n.remove(z)}}return true}else{if(c(y)){if(x.nodeName=="LI"){n.insertAfter(y,x);y.appendChild(z);A(x)}else{if(b(x)){x.insertBefore(y,z)}else{x.insertBefore(k(y),z);n.remove(y)}}return true}else{if(f(y)){if(x.nodeName=="LI"){n.insertAfter(y,x)}else{if(b(x)){n.insertAfter(y,z)}else{n.insertAfter(k(y),z);n.remove(y)}}return true}else{if(x.nodeName=="LI"){z=x;B=k(y,"LI")}else{if(b(x)){B=k(y,"LI")}else{B=k(y)}}o(z,y,B);g(z.parentNode);return true}}}return false}function i(x){var z,y;function A(D,C){var B;if(b(D)){while((B=x.lastChild.firstChild)){C.appendChild(B)}n.remove(D)}}if(x.nodeName=="DT"){n.rename(x,"DD");return true}z=x.previousSibling;if(z&&b(z)){z.appendChild(x);return true}if(z&&z.nodeName=="LI"&&b(z.lastChild)){z.lastChild.appendChild(x);A(x.lastChild,z.lastChild);return true}z=x.nextSibling;if(z&&b(z)){z.insertBefore(x,z.firstChild);return true}if(z&&z.nodeName=="LI"&&b(x.lastChild)){return false}z=x.previousSibling;if(z&&z.nodeName=="LI"){y=n.create(x.parentNode.nodeName);z.appendChild(y);y.appendChild(x);A(x.lastChild,y);return true}return false}function h(){var y=p();if(y.length){var z=u(v.getRng(true));for(var x=0;x<y.length;x++){if(!i(y[x])&&x===0){break}}t(z);d.nodeChanged();return true}}function q(){var A=p();if(A.length){var B=u(v.getRng(true));var z,D,x=d.getBody();z=A.length;while(z--){var C=A[z].parentNode;while(C&&C!=x){D=A.length;while(D--){if(A[D]===C){A.splice(z,1);break}}C=C.parentNode}}for(z=0;z<A.length;z++){if(!s(A[z])&&z===0){break}}t(B);d.nodeChanged();return true}}function j(z){var y=v.getRng(true),B=u(y),A="LI";z=z.toUpperCase();if(z=="DL"){A="DT"}function x(){var H=[],D=d.getBody();function F(M){var K,L;K=y[M?"startContainer":"endContainer"];L=y[M?"startOffset":"endOffset"];if(K.nodeType==1){K=K.childNodes[Math.min(L,K.childNodes.length-1)]||K}while(K.parentNode!=D){if(e(K)){return K}if(/^(TD|TH)$/.test(K.parentNode.nodeName)){return K}K=K.parentNode}return K}var E=F(true);var C=F();var J,I=[];for(var G=E;G;G=G.nextSibling){I.push(G);if(G==C){break}}tinymce.each(I,function(K){if(e(K)){H.push(K);J=null;return}if(n.isBlock(K)||K.nodeName=="BR"){if(K.nodeName=="BR"){n.remove(K)}J=null;return}var L=K.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode(K)){if(e(L)||(!L&&K.parentNode==D)){J=null;return}}if(!J){J=n.create("p");K.parentNode.insertBefore(J,K);H.push(J)}J.appendChild(K)});return H}tinymce.each(x(),function(E){var C,D;D=E.previousSibling;if(D&&b(D)&&D.nodeName==z){C=D;E=n.rename(E,A);D.appendChild(E)}else{C=n.create(z);E.parentNode.insertBefore(C,E);C.appendChild(E);E=n.rename(E,A)}w(C)});t(B)}function r(){var y=u(v.getRng(true)),x=d.getBody();tinymce.each(p(),function(z){var B,A;if(n.isEmpty(z)){s(z);return}for(B=z;B&&B!=x;B=B.parentNode){if(b(B)){A=B}}o(A,z)});t(y)}function m(y){var x=n.getParent(v.getStart(),"OL,UL,DL");if(x){if(x.nodeName==y){r(y)}else{var z=u(v.getRng(true));w(n.rename(x,y));t(z)}}else{j(y)}}function l(x){return function(){var y=n.getParent(d.selection.getStart(),"UL,OL,DL");return y&&y.nodeName==x}}a.backspaceDelete=function(B){function C(F,H){var G=F.startContainer,J=F.startOffset;var E,I;if(G.nodeType==3&&(H?J<G.data.length:J>0)){return G}E=d.schema.getNonEmptyElements();I=new tinymce.dom.TreeWalker(F.startContainer);while((G=I[H?"next":"prev"]())){if(G.nodeName=="LI"&&!G.hasChildNodes()){return G}if(E[G.nodeName]){return G}if(G.nodeType==3&&G.data.length>0){return G}}}function D(F,I){var H,G,E=F.parentNode;if(b(I.lastChild)){G=I.lastChild}H=I.lastChild;if(H&&H.nodeName=="BR"&&F.hasChildNodes()){n.remove(H)}if(n.isEmpty(I)){n.$(I).empty()}if(!n.isEmpty(F)){while((H=F.firstChild)){I.appendChild(H)}}if(G){I.appendChild(G)}n.remove(F);if(n.isEmpty(E)){n.remove(E)}}if(v.isCollapsed()){var x=n.getParent(v.getStart(),"LI");if(x){var z=v.getRng(true);var y=n.getParent(C(z,B),"LI");if(y&&y!=x){var A=u(z);if(B){D(y,x)}else{D(x,y)}t(A);return true}else{if(!y){if(!B&&r(x.parentNode.nodeName)){return true}}}}}};d.on("BeforeExecCommand",function(z){var y=z.command.toLowerCase(),x;if(y=="indent"){if(h()){x=true}}else{if(y=="outdent"){if(q()){x=true}}}if(x){d.fire("ExecCommand",{command:z.command});z.preventDefault();return true}});d.addCommand("InsertUnorderedList",function(){m("UL")});d.addCommand("InsertOrderedList",function(){m("OL")});d.addCommand("InsertDefinitionList",function(){m("DL")});d.addQueryStateHandler("InsertUnorderedList",l("UL"));d.addQueryStateHandler("InsertOrderedList",l("OL"));d.addQueryStateHandler("InsertDefinitionList",l("DL"));d.on("keydown",function(x){if(x.keyCode!=9||tinymce.util.VK.metaKeyPressed(x)){return}if(d.dom.getParent(d.selection.getStart(),"LI,DT,DD")){x.preventDefault();if(x.shiftKey){q()}else{h()}}})});d.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var g=this;d.on("nodechange",function(){var n=d.selection.getSelectedBlocks();var k=false;for(var m=0,j=n.length;!k&&m<j;m++){var h=n[m].nodeName;k=(h=="LI"&&c(n[m])||h=="UL"||h=="OL"||h=="DD")}g.disabled(k)})}});d.on("keydown",function(g){if(g.keyCode==tinymce.util.VK.BACKSPACE){if(a.backspaceDelete()){g.preventDefault()}}else{if(g.keyCode==tinymce.util.VK.DELETE){if(a.backspaceDelete(true)){g.preventDefault()}}}})});
// plugin.js
tinymce.PluginManager.add("link",function(b){function a(){var h={},k=b.selection,g=b.dom,e,p,m;var i,j,f,c;function l(){var q=[{text:"None",value:""}];tinymce.each(b.settings.link_list,function(r){q.push({text:r.text||r.title,value:r.value||r.url,menu:r.menu})});return q}function o(q){var r=[{text:"None",value:""}];tinymce.each(b.settings.rel_list,function(s){r.push({text:s.text||s.title,value:s.value,selected:q===s.value})});return r}function n(r){var q=[{text:"None",value:""}];if(!b.settings.target_list){q.push({text:"New window",value:"_blank"})}tinymce.each(b.settings.target_list,function(s){q.push({text:s.text||s.title,value:s.value,selected:r===s.value})});return q}function d(){if(!m&&h.text.length===0){this.parent().parent().find("#text")[0].value(this.value())}}e=k.getNode();p=g.getParent(e,"a[href]");if(p){k.select(p)}h.text=m=k.getContent({format:"text"});h.href=p?g.getAttrib(p,"href"):"";h.target=p?g.getAttrib(p,"target"):"";h.rel=p?g.getAttrib(p,"rel"):"";if(e.nodeName=="IMG"){h.text=m=" "}if(b.settings.link_list){j={type:"listbox",label:"Link list",values:l(),onselect:function(q){var r=i.find("#text");if(!r.value()||(q.lastControl&&r.value()==q.lastControl.text())){r.value(q.control.text())}i.find("#href").value(q.control.value())}}}if(b.settings.target_list!==false){c={name:"target",type:"listbox",label:"Target",values:n(h.target)}}if(b.settings.rel_list){f={name:"rel",type:"listbox",label:"Rel",values:o(h.rel)}}i=b.windowManager.open({title:"Insert link",data:h,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:true,label:"Url",onchange:d,onkeyup:d},{name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){h.text=this.value()}},j,f,c],onSubmit:function(r){var q=r.data;if(!q.href){b.execCommand("unlink");return}if(q.text!=m){if(p){b.focus();p.innerHTML=q.text;g.setAttribs(p,{href:q.href,target:q.target?q.target:null,rel:q.rel?q.rel:null});k.select(p)}else{b.insertContent(g.createHTML("a",{href:q.href,target:q.target?q.target:null,rel:q.rel?q.rel:null},q.text))}}else{b.execCommand("mceInsertLink",false,{href:q.href,target:q.target,rel:q.rel?q.rel:null})}}})}b.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:a,stateSelector:"a[href]"});b.addButton("unlink",{icon:"unlink",tooltip:"Remove link(s)",cmd:"unlink",stateSelector:"a[href]"});b.addShortcut("Ctrl+K","",a);this.showDialog=a;b.addMenuItem("link",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:a,stateSelector:"a[href]",context:"insert",prependToContext:true})});
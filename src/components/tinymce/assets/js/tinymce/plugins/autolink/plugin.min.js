// plugin.js
tinymce.PluginManager.add("autolink",function(c){c.on("keydown",function(f){if(f.keyCode==13){return b(c)}});if(tinymce.Env.ie){return}c.on("keypress",function(f){if(f.which==41){return d(c)}});c.on("keyup",function(f){if(f.keyCode==32){return a(c)}});function d(f){e(f,-1,"(",true)}function a(f){e(f,0,"",true)}function b(f){e(f,-1,"",false)}function e(n,i,g){var f,k,h,r,o,q,l,j,m;f=n.selection.getRng(true).cloneRange();if(f.startOffset<5){j=f.endContainer.previousSibling;if(!j){if(!f.endContainer.firstChild||!f.endContainer.firstChild.nextSibling){return}j=f.endContainer.firstChild.nextSibling}m=j.length;f.setStart(j,m);f.setEnd(j,m);if(f.endOffset<5){return}k=f.endOffset;r=j}else{r=f.endContainer;if(r.nodeType!=3&&r.firstChild){while(r.nodeType!=3&&r.firstChild){r=r.firstChild}if(r.nodeType==3){f.setStart(r,0);f.setEnd(r,r.nodeValue.length)}}if(f.endOffset==1){k=2}else{k=f.endOffset-1-i}}h=k;do{f.setStart(r,k>=2?k-2:0);f.setEnd(r,k>=1?k-1:0);k-=1}while(f.toString()!=" "&&f.toString()!==""&&f.toString().charCodeAt(0)!=160&&(k-2)>=0&&f.toString()!=g);if(f.toString()==g||f.toString().charCodeAt(0)==160){f.setStart(r,k);f.setEnd(r,h);k+=1}else{if(f.startOffset===0){f.setStart(r,0);f.setEnd(r,h)}else{f.setStart(r,k);f.setEnd(r,h)}}q=f.toString();if(q.charAt(q.length-1)=="."){f.setEnd(r,h-1)}q=f.toString();l=q.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i);if(l){if(l[1]=="www."){l[1]="http://www."}else{if(/@$/.test(l[1])&&!/^mailto:/.test(l[1])){l[1]="mailto:"+l[1]}}o=n.selection.getBookmark();n.selection.setRng(f);n.execCommand("createlink",false,l[1]+l[2]);n.selection.moveToBookmark(o);n.nodeChanged();if(tinymce.Env.webkit){n.selection.collapse(false);var p=Math.min(r.length,h+1);f.setStart(r,p);f.setEnd(r,p);n.selection.setRng(f)}}}});
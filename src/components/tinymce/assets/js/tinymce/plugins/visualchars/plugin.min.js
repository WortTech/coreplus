// plugin.js
tinymce.PluginManager.add("visualchars",function(b){var d,a;function c(j){var f,g,h,k=b.getBody(),l,n=b.selection,e,m;d=!d;a.active(d);if(j){m=n.getBookmark()}if(d){g=[];tinymce.walk(k,function(i){if(i.nodeType==3&&i.nodeValue&&i.nodeValue.indexOf("\u00a0")!=-1){g.push(i)}},"childNodes");for(h=0;h<g.length;h++){l=g[h].nodeValue;l=l.replace(/(\u00a0)/g,'<span data-mce-bogus="1" class="mce-nbsp">$1</span>');e=b.dom.create("div",null,l);while((f=e.lastChild)){b.dom.insertAfter(f,g[h])}b.dom.remove(g[h])}}else{g=b.dom.select("span.mce-nbsp",k);for(h=g.length-1;h>=0;h--){b.dom.remove(g[h],1)}}n.moveToBookmark(m)}b.addCommand("mceVisualChars",c);b.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars"});b.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:function(){a=this},selectable:true,context:"view",prependToContext:true});b.on("beforegetcontent",function(f){if(d&&f.format!="raw"&&!f.draft){d=true;c(false)}})});
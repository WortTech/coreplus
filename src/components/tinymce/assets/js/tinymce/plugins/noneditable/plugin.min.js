// plugin.js
tinymce.PluginManager.add("noneditable",function(e){var g=tinymce.dom.TreeWalker;var c="contenteditable",b="data-mce-"+c;var h=tinymce.util.VK;function f(){var o=e.dom,t=e.selection,s="mce_noneditablecaret",v="\uFEFF";function r(x){var w;if(x.nodeType===1){w=x.getAttribute(b);if(w&&w!=="inherit"){return w}w=x.contentEditable;if(w!=="inherit"){return w}}return null}function l(w){var x;while(w){x=r(w);if(x){return x==="false"?w:null}w=w.parentNode}}function q(w){while(w){if(w.id===s){return w}w=w.parentNode}}function p(w){var x;if(w){x=new g(w,w);for(w=x.current();w;w=x.next()){if(w.nodeType===3){return w}}}}function k(z,y){var w,x;if(r(z)==="false"){if(o.isBlock(z)){t.select(z);return}}x=o.createRng();if(r(z)==="true"){if(!z.firstChild){z.appendChild(e.getDoc().createTextNode("\u00a0"))}z=z.firstChild;y=true}w=o.create("span",{id:s,"data-mce-bogus":true},v);if(y){z.parentNode.insertBefore(w,z)}else{o.insertAfter(w,z)}x.setStart(w.firstChild,1);x.collapse(true);t.setRng(x);return w}function n(w){var x,A,y,z;if(w){x=t.getRng(true);x.setStartBefore(w);x.setEndBefore(w);A=p(w);if(A&&A.nodeValue.charAt(0)==v){A=A.deleteData(0,1)}o.remove(w,true);t.setRng(x)}else{y=q(t.getStart());while((w=o.get(s))&&w!==z){if(y!==w){A=p(w);if(A&&A.nodeValue.charAt(0)==v){A=A.deleteData(0,1)}o.remove(w,true)}z=w}}}function u(){var w,A,y,x,z;function B(E,G){var D,I,H,F,C;D=x.startContainer;I=x.startOffset;if(D.nodeType==3){C=D.nodeValue.length;if((I>0&&I<C)||(G?I==C:I===0)){return}}else{if(I<D.childNodes.length){var J=!G&&I>0?I-1:I;D=D.childNodes[J];if(D.hasChildNodes()){D=D.firstChild}}else{return !G?E:null}}H=new g(D,E);while((F=H[G?"prev":"next"]())){if(F.nodeType===3&&F.nodeValue.length>0){return}else{if(r(F)==="true"){return F}}}return E}n();y=t.isCollapsed();w=l(t.getStart());A=l(t.getEnd());if(w||A){x=t.getRng(true);if(y){w=w||A;if((z=B(w,true))){k(z,true)}else{if((z=B(w,false))){k(z,false)}else{t.select(w)}}}else{x=t.getRng(true);if(w){x.setStartBefore(w)}if(A){x.setEndAfter(A)}t.setRng(x)}}}function m(E){var I=E.keyCode,B,F,G,z;function y(K,J){while((K=K[J?"previousSibling":"nextSibling"])){if(K.nodeType!==3||K.nodeValue.length>0){return K}}}function C(J,K){t.select(J);t.collapse(K)}function x(N){var M,L,P,K;function J(R){var Q=L;while(Q){if(Q===R){return}Q=Q.parentNode}o.remove(R);u()}function O(){var R,S,Q=e.schema.getNonEmptyElements();S=new tinymce.dom.TreeWalker(L,e.getBody());while((R=(N?S.prev():S.next()))){if(Q[R.nodeName.toLowerCase()]){break}if(R.nodeType===3&&tinymce.trim(R.nodeValue).length>0){break}if(r(R)==="false"){J(R);return true}}if(l(R)){return true}return false}if(t.isCollapsed()){M=t.getRng(true);L=M.startContainer;P=M.startOffset;L=q(L)||L;if((K=l(L))){J(K);return false}if(L.nodeType==3&&(N?P>0:P<L.nodeValue.length)){return true}if(L.nodeType==1){L=L.childNodes[P]||L}if(O()){return false}}return true}G=t.getStart();z=t.getEnd();B=l(G)||l(z);if(B&&(I<112||I>124)&&I!=h.DELETE&&I!=h.BACKSPACE){if((tinymce.isMac?E.metaKey:E.ctrlKey)&&(I==67||I==88||I==86)){return}E.preventDefault();if(I==h.LEFT||I==h.RIGHT){var A=I==h.LEFT;if(e.dom.isBlock(B)){var D=A?B.previousSibling:B.nextSibling;var w=new g(D,D);var H=A?w.prev():w.next();C(H,!A)}else{C(B,A)}}}else{if(I==h.LEFT||I==h.RIGHT||I==h.BACKSPACE||I==h.DELETE){F=q(G);if(F){if(I==h.LEFT||I==h.BACKSPACE){B=y(F,true);if(B&&r(B)==="false"){E.preventDefault();if(I==h.LEFT){C(B,true)}else{o.remove(B);return}}else{n(F)}}if(I==h.RIGHT||I==h.DELETE){B=y(F);if(B&&r(B)==="false"){E.preventDefault();if(I==h.RIGHT){C(B,false)}else{o.remove(B);return}}else{n(F)}}}if((I==h.BACKSPACE||I==h.DELETE)&&!x(I==h.BACKSPACE)){E.preventDefault();return false}}}}e.on("mousedown",function(x){var w=e.selection.getNode();if(r(w)==="false"&&w==x.target){u()}});e.on("mouseup keyup",u);e.on("keydown",m)}var d,j,a;function i(n){var l=a.length,m=n.content,k=tinymce.trim(j);if(n.format=="raw"){return}while(l--){m=m.replace(a[l],function(q){var p=arguments,o=p[p.length-2];if(o>0&&m.charAt(o-1)=='"'){return q}return('<span class="'+k+'" data-mce-content="'+e.dom.encode(p[0])+'">'+e.dom.encode(typeof(p[1])==="string"?p[1]:p[0])+"</span>")})}n.content=m}d=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ";j=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ";a=e.getParam("noneditable_regexp");if(a&&!a.length){a=[a]}e.on("PreInit",function(){f();if(a){e.on("BeforeSetContent",i)}e.parser.addAttributeFilter("class",function(k){var l=k.length,m,n;while(l--){n=k[l];m=" "+n.attr("class")+" ";if(m.indexOf(d)!==-1){n.attr(b,"true")}else{if(m.indexOf(j)!==-1){n.attr(b,"false")}}}});e.serializer.addAttributeFilter(b,function(k){var l=k.length,m;while(l--){m=k[l];if(a&&m.attr("data-mce-content")){m.name="#text";m.type=3;m.raw=true;m.value=m.attr("data-mce-content")}else{m.attr(c,null);m.attr(b,null)}}});e.parser.addAttributeFilter(c,function(k){var l=k.length,m;while(l--){m=k[l];m.attr(b,m.attr(c));m.attr(c,null)}})})});
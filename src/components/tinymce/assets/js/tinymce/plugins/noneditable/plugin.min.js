// plugin.js
tinymce.PluginManager.add("noneditable",function(g){var i=tinymce.dom.TreeWalker;var d="contenteditable",c="data-mce-"+d;var j=tinymce.util.VK;function f(n){var m;if(n.nodeType===1){m=n.getAttribute(c);if(m&&m!=="inherit"){return m}m=n.contentEditable;if(m!=="inherit"){return m}}return null}function a(m){var n;while(m){n=f(m);if(n){return n==="false"?m:null}m=m.parentNode}}function h(){var p=g.dom,t=g.selection,s="mce_noneditablecaret",v="\uFEFF";function r(w){while(w){if(w.id===s){return w}w=w.parentNode}}function q(w){var x;if(w){x=new i(w,w);for(w=x.current();w;w=x.next()){if(w.nodeType===3){return w}}}}function m(z,y){var w,x;if(f(z)==="false"){if(p.isBlock(z)){t.select(z);return}}x=p.createRng();if(f(z)==="true"){if(!z.firstChild){z.appendChild(g.getDoc().createTextNode("\u00a0"))}z=z.firstChild;y=true}w=p.create("span",{id:s,"data-mce-bogus":true},v);if(y){z.parentNode.insertBefore(w,z)}else{p.insertAfter(w,z)}x.setStart(w.firstChild,1);x.collapse(true);t.setRng(x);return w}function o(w){var x,z,y;if(w){x=t.getRng(true);x.setStartBefore(w);x.setEndBefore(w);z=q(w);if(z&&z.nodeValue.charAt(0)==v){z=z.deleteData(0,1)}p.remove(w,true);t.setRng(x)}else{while((w=p.get(s))&&w!==y){z=q(w);if(z&&z.nodeValue.charAt(0)==v){z=z.deleteData(0,1)}p.remove(w,true);y=w}}}function u(){var w,A,y,x,z;function B(E,G){var D,I,H,F,C;D=x.startContainer;I=x.startOffset;if(D.nodeType==3){C=D.nodeValue.length;if((I>0&&I<C)||(G?I==C:I===0)){return}}else{if(I<D.childNodes.length){var J=!G&&I>0?I-1:I;D=D.childNodes[J];if(D.hasChildNodes()){D=D.firstChild}}else{return !G?E:null}}H=new i(D,E);while((F=H[G?"prev":"next"]())){if(F.nodeType===3&&F.nodeValue.length>0){return}else{if(f(F)==="true"){return F}}}return E}o();y=t.isCollapsed();w=a(t.getStart());A=a(t.getEnd());if(w||A){x=t.getRng(true);if(y){w=w||A;if((z=B(w,true))){m(z,true)}else{if((z=B(w,false))){m(z,false)}else{t.select(w)}}}else{x=t.getRng(true);if(w){x.setStartBefore(w)}if(A){x.setEndAfter(A)}t.setRng(x)}}}function n(O){var D=O.keyCode,P,F,w,C;function x(R,Q){while((R=R[Q?"previousSibling":"nextSibling"])){if(R.nodeType!==3||R.nodeValue.length>0){return R}}}function G(Q,R){t.select(Q);t.collapse(R)}function L(U){var T,S,W,R;function Q(Y){var X=S;while(X){if(X===Y){return}X=X.parentNode}p.remove(Y);u()}function V(){var Y,Z,X=g.schema.getNonEmptyElements();Z=new tinymce.dom.TreeWalker(S,g.getBody());while((Y=(U?Z.prev():Z.next()))){if(X[Y.nodeName.toLowerCase()]){break}if(Y.nodeType===3&&tinymce.trim(Y.nodeValue).length>0){break}if(f(Y)==="false"){Q(Y);return true}}if(a(Y)){return true}return false}if(t.isCollapsed()){T=t.getRng(true);S=T.startContainer;W=T.startOffset;S=r(S)||S;if((R=a(S))){Q(R);return false}if(S.nodeType==3&&(U?W>0:W<S.nodeValue.length)){return true}if(S.nodeType==1){S=S.childNodes[W]||S}if(V()){return false}}return true}u();w=t.getStart();C=t.getEnd();P=a(w)||a(C);var y=g.selection.getNode();var N=D==j.LEFT||D==j.RIGHT||D==j.UP||D==j.DOWN;var z=D==j.LEFT||D==j.UP;if(P&&(D<112||D>124)&&D!=j.DELETE&&D!=j.BACKSPACE){if((tinymce.isMac?O.metaKey:O.ctrlKey)&&(D==67||D==88||D==86)){return}O.preventDefault();if(N){if(g.dom.isBlock(P)){var E=z?P.previousSibling:P.nextSibling;if(!E||E&&f(E)==="false"){var J=p.create("p",null,"&nbsp;");J.className="mceTmpParagraph";var B=z?P:E;if(B&&B.parentNode){B.parentNode.insertBefore(J,B)}else{if(!E&&!z){P.parentNode.appendChild(J)}}E=J}var K=new i(E,E);var I=z?K.prev():K.next();G(I,!z)}else{G(P,z)}}}else{if(N||D==j.BACKSPACE||D==j.DELETE){F=r(w);if(F){if(D==j.LEFT||D==j.BACKSPACE){P=x(F,true);if(P&&f(P)==="false"){O.preventDefault();if(D==j.LEFT){G(P,true)}else{p.remove(P);return}}else{o(F)}}if(D==j.RIGHT||D==j.DELETE){P=x(F,true);if(P&&f(P)==="false"){O.preventDefault();if(D==j.RIGHT){G(P,false)}else{p.remove(P);return}}else{o(F)}}}else{if(N){if(y&&y.className.indexOf("mceTmpParagraph")!==-1&&y[z?"previousSibling":"nextSibling"]){var M=y[z?"previousSibling":"nextSibling"];if(y.innerHTML==="&nbsp;"||y.innerHTML===""||y.innerHTML===" "){p.remove(y)}else{y.className=y.className.replace("mceTmpParagraph","")}G(M,!z)}}var A=t.getRng(true);var H=A.endContainer;if(p.isBlock(H)&&p.isBlock(H.nextSibling)&&A.endOffset==1&&D==j.DELETE){P=a(H.nextSibling)}if(P&&(D==j.DELETE||D==j.BACKSPACE)&&p.isBlock(P)){O.preventDefault();p.remove(P);return}}if((D==j.BACKSPACE||D==j.DELETE)&&!L(D==j.BACKSPACE)){O.preventDefault();return false}}}}g.on("mousedown",function(x){var w=g.selection.getNode();if(w&&w.className.indexOf("mceTmpParagraph")!==-1&&w!==x.target){if(w.innerHTML==="&nbsp;"||w.innerHTML===""||w.innerHTML===" "){p.remove(w)}else{w.className=w.className.replace("mceTmpParagraph","")}}if(f(w)==="false"&&w==x.target){u()}});g.on("mouseup",u);g.on("keydown",n)}var e,l,b;function k(p){var n=b.length,o=p.content,m=tinymce.trim(l);if(p.format=="raw"){return}while(n--){o=o.replace(b[n],function(s){var r=arguments,q=r[r.length-2];if(q>0&&o.charAt(q-1)=='"'){return s}return('<span class="'+m+'" data-mce-content="'+g.dom.encode(r[0])+'">'+g.dom.encode(typeof r[1]==="string"?r[1]:r[0])+"</span>")})}p.content=o}e=" "+tinymce.trim(g.getParam("noneditable_editable_class","mceEditable"))+" ";l=" "+tinymce.trim(g.getParam("noneditable_noneditable_class","mceNonEditable"))+" ";b=g.getParam("noneditable_regexp");if(b&&!b.length){b=[b]}g.on("PreInit",function(){h();if(b){g.on("BeforeSetContent",k)}g.parser.addAttributeFilter("class",function(m){var n=m.length,o,p;while(n--){p=m[n];o=" "+p.attr("class")+" ";if(o.indexOf(e)!==-1){p.attr(c,"true")}else{if(o.indexOf(l)!==-1){p.attr(c,"false")}}}});g.serializer.addAttributeFilter(c,function(m){var n=m.length,o;while(n--){o=m[n];if(b&&o.attr("data-mce-content")){o.name="#text";o.type=3;o.raw=true;o.value=o.attr("data-mce-content")}else{o.attr(d,null);o.attr(c,null)}}});g.parser.addAttributeFilter(d,function(m){var n=m.length,o;while(n--){o=m[n];o.attr(c,o.attr(d));o.attr(d,null)}})});g.on("drop",function(m){if(a(m.target)){m.preventDefault()}})});
// plugin.js
tinymce.PluginManager.add("textcolor",function(f){var g,j;j=f.settings.textcolor_rows||5;g=f.settings.textcolor_cols||8;function a(l){var k;f.dom.getParents(f.selection.getStart(),function(n){var m;if((m=n.style[l=="forecolor"?"color":"background-color"])){k=m}});return k}function h(){var m,k=[],l;l=f.settings.textcolor_map||["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"];for(m=0;m<l.length;m+=2){k.push({text:l[m+1],color:"#"+l[m]})}return k}function b(){var k=this,l,n,p,u,t,s,o,m=k._id,q=0;function r(v,x){var w=v=="transparent";return('<td class="mce-grid-cell'+(w?" mce-colorbtn-trans":"")+'"><div id="'+m+"-"+(q++)+'" data-mce-color="'+(v?v:"")+'" role="option" tabIndex="-1" style="'+(v?"background-color: "+v:"")+'" title="'+tinymce.translate(x)+'">'+(w?"&#215;":"")+"</div></td>")}l=h();l.push({text:tinymce.translate("No color"),color:"transparent"});p='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>';u=l.length-1;for(s=0;s<j;s++){p+="<tr>";for(t=0;t<g;t++){o=s*g+t;if(o>u){p+="<td></td>"}else{n=l[o];p+=r(n.color,n.text)}}p+="</tr>"}if(f.settings.color_picker_callback){p+=('<tr><td colspan="'+g+'" class="mce-custom-color-btn"><div id="'+m+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+m+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>");p+="<tr>";for(t=0;t<g;t++){p+=r("","Custom color")}p+="</tr>"}p+="</tbody></table>";return p}function c(l,k){f.undoManager.transact(function(){f.focus();f.formatter.apply(l,{value:k});f.nodeChanged()})}function i(k){f.undoManager.transact(function(){f.focus();f.formatter.remove(k,{value:null},null,true);f.nodeChanged()})}function d(p){var m=this.parent(),o;function l(q){m.hidePanel();m.color(q);c(m.settings.format,q)}function n(){m.hidePanel();m.resetColor();i(m.settings.format)}function k(r,q){r.style.background=q;r.setAttribute("data-mce-color",q)}if(tinymce.DOM.getParent(p.target,".mce-custom-color-btn")){m.hidePanel();f.settings.color_picker_callback.call(f,function(t){var q=m.panel.getEl().getElementsByTagName("table")[0];var s,u,r;s=tinymce.map(q.rows[q.rows.length-1].childNodes,function(v){return v.firstChild});for(r=0;r<s.length;r++){u=s[r];if(!u.getAttribute("data-mce-color")){break}}if(r==g){for(r=0;r<g-1;r++){k(s[r],s[r+1].getAttribute("data-mce-color"))}}k(u,t);l(t)},a(m.settings.format))}o=p.target.getAttribute("data-mce-color");if(o){if(this.lastId){document.getElementById(this.lastId).setAttribute("aria-selected",false)}p.target.setAttribute("aria-selected",true);this.lastId=p.target.id;if(o=="transparent"){n()}else{l(o)}}else{if(o!==null){m.hidePanel()}}}function e(){var k=this;if(k._color){c(k.settings.format,k._color)}else{i(k.settings.format)}}f.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{role:"application",ariaRemember:true,html:b,onclick:d},onclick:e});f.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{role:"application",ariaRemember:true,html:b,onclick:d},onclick:e})});
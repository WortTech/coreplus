// plugin.js
tinymce.PluginManager.add("template",function(d){var e=tinymce.each;function a(){var j,i=[],h;if(!d.settings.templates){d.windowManager.alert("No templates defined");return}tinymce.each(d.settings.templates,function(k){i.push({text:k.title,value:{url:k.url,content:k.content,description:k.description}})});function g(l){var k=l.control.value();if(k.url){tinymce.util.XHR.send({url:k.url,success:function(m){h=m;j.find("iframe")[0].html(m)}})}else{h=k.content;j.find("iframe")[0].html(k.content)}j.find("#description")[0].text(l.control.value().description)}j=d.windowManager.open({title:"Insert template",body:[{type:"listbox",name:"template",flex:0,label:"Templates",values:i,onselect:g},{type:"label",name:"description",label:"Description",text:""},{type:"iframe",minWidth:600,minHeight:400,border:1}],onsubmit:function(){c(false,h)}})}function b(h,k){var g="Sun Mon Tue Wed Thu Fri Sat Sun".split(" ");var m="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");var l="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");var j="January February March April May June July August September October November December".split(" ");function i(p,n){p=""+p;if(p.length<n){for(var o=0;o<(n-p.length);o++){p="0"+p}}return p}k=k||new Date();h=h.replace("%D","%m/%d/%Y");h=h.replace("%r","%I:%M:%S %p");h=h.replace("%Y",""+k.getFullYear());h=h.replace("%y",""+k.getYear());h=h.replace("%m",i(k.getMonth()+1,2));h=h.replace("%d",i(k.getDate(),2));h=h.replace("%H",""+i(k.getHours(),2));h=h.replace("%M",""+i(k.getMinutes(),2));h=h.replace("%S",""+i(k.getSeconds(),2));h=h.replace("%I",""+((k.getHours()+11)%12+1));h=h.replace("%p",""+(k.getHours()<12?"AM":"PM"));h=h.replace("%B",""+d.translate(j[k.getMonth()]));h=h.replace("%b",""+d.translate(l[k.getMonth()]));h=h.replace("%A",""+d.translate(m[k.getDay()]));h=h.replace("%a",""+d.translate(g[k.getDay()]));h=h.replace("%%","%");return h}function f(h){var i=d.dom,g=d.getParam("template_replace_values");e(i.select("*",h),function(j){e(g,function(m,l){if(i.hasClass(j,l)){if(typeof(g[l])=="function"){g[l](j)}}})})}function c(k,h){var i,m,l=d.dom,j=d.selection.getContent();e(d.getParam("template_replace_values"),function(o,n){if(typeof(o)!="function"){h=h.replace(new RegExp("\\{\\$"+n+"\\}","g"),o)}});i=l.create("div",null,h);m=l.select(".mceTmpl",i);if(m&&m.length>0){i=l.create("div",null);i.appendChild(m[0].cloneNode(true))}function g(p,o){return new RegExp("\\b"+o+"\\b","g").test(p.className)}e(l.select("*",i),function(o){if(g(o,d.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))){o.innerHTML=b(d.getParam("template_cdate_format",d.getLang("template.cdate_format")))}if(g(o,d.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){o.innerHTML=b(d.getParam("template_mdate_format",d.getLang("template.mdate_format")))}if(g(o,d.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))){o.innerHTML=j}});f(i);d.execCommand("mceInsertContent",false,i.innerHTML);d.addVisual()}d.addCommand("mceInsertTemplate",c);d.addButton("template",{title:"Insert template",onclick:a});d.addMenuItem("image",{text:"Insert template",onclick:a,context:"insert"});d.on("PreProcess",function(h){var g=d.dom;e(g.select("div",h.node),function(i){if(g.hasClass(i,"mceTmpl")){e(g.select("*",i),function(j){if(g.hasClass(j,d.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){j.innerHTML=b(d.getParam("template_mdate_format",d.getLang("template.mdate_format")))}});f(i)}})})});
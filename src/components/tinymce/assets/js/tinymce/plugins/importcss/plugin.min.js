// plugin.js
tinymce.PluginManager.add("importcss",function(d){var b=this,e=tinymce.each;function c(g){if(typeof g=="string"){return function(h){return h.indexOf(g)!==-1}}else{if(g instanceof RegExp){return function(h){return g.test(h)}}}return g}function a(l,j){var i=[],h={};function g(q,p){var m=q.href,o;if(!m||!j(m,p)){return}e(q.imports,function(r){g(r,true)});try{o=q.cssRules||q.rules}catch(n){}e(o,function(r){if(r.styleSheet){g(r.styleSheet,true)}else{if(r.selectorText){e(r.selectorText.split(","),function(s){i.push(tinymce.trim(s))})}}})}e(d.contentCSS,function(m){h[m]=true});if(!j){j=function(m,n){return n||h[m]}}try{e(l.styleSheets,function(m){g(m)})}catch(k){}return i}function f(k){var l;var h=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(k);if(!h){return}var g=h[1];var i=h[2].substr(1).split(".").join(" ");var j=tinymce.makeMap("a,img");if(h[1]){l={title:k};if(d.schema.getTextBlockElements()[g]){l.block=g}else{if(d.schema.getBlockElements()[g]||j[g.toLowerCase()]){l.selector=g}else{l.inline=g}}}else{if(h[2]){l={inline:"span",title:k.substr(1),classes:i}}}if(d.settings.importcss_merge_classes!==false){l.classes=i}else{l.attributes={"class":i}}return l}d.on("renderFormatsMenu",function(m){var j=d.settings,i={};var h=j.importcss_selector_converter||f;var l=c(j.importcss_selector_filter),k=m.control;if(!d.settings.importcss_append){k.items().remove()}var g=[];tinymce.each(j.importcss_groups,function(n){n=tinymce.extend({},n);n.filter=c(n.filter);g.push(n)});e(a(m.doc||d.getDoc(),c(j.importcss_file_filter)),function(n){if(n.indexOf(".mce-")===-1){if(!i[n]&&(!l||l(n))){var r=h.call(b,n),s;if(r){var q=r.name||tinymce.DOM.uniqueId();if(g){for(var o=0;o<g.length;o++){if(!g[o].filter||g[o].filter(n)){if(!g[o].item){g[o].item={text:g[o].title,menu:[]}}s=g[o].item.menu;break}}}d.formatter.register(q,r);var p=tinymce.extend({},k.settings.itemDefaults,{text:r.title,format:q});if(s){s.push(p)}else{k.add(p)}}i[n]=true}}});e(g,function(n){k.add(n.item)});m.control.renderNew()});b.convertSelectorToFormat=f});
var NavigationManager=null;(function(){var f=0,c={},d={"int":null,ext:null,none:null},b,h,a,e,g;b=function(i){var k=i.find("option:selected"),j=Core.Strings.trim(k.html());return j.replace(/ \(.*\)$/,"").replace(/.*Â» (.*)$/,"$1")};g='<ul class="controls" style=""><li><a href="#" class="edit-entry-link control control-edit"><i class="icon icon-edit"></i><span>edit entry</span></a></li><li><a href="#" class="delete-entry-link control control-delete"><i class="icon icon-remove"></i><span>delete entry</span></a></li></ul>';a=function(k,j){var i=this;this.$dialog=null;this.beforesave=function(){return true};this.open=function(o){var r,q,n,p,l,m;if(typeof o=="undefined"){m="New "+j}else{l=o.closest("div.entry");r=l.closest("li").attr("entryid");q=l.find(".entry-title").val();n=l.find(".entry-url").val();p=l.find(".entry-target").val();m="Edit "+q}this.$dialog.find("input[name=id]").val(r);this.$dialog.find("input[name=title]").val(q);this.$dialog.find(":input[name=url]").val(n);this.$dialog.find(":input[name=target]").val(p);this.$dialog.show().dialog({modal:true,autoOpen:false,title:m,width:"500px"}).dialog("open")};this.save=function(){var l={id:this.$dialog.find(":input[name=id]").val(),type:k,url:this.$dialog.find(":input[name=url]").val(),target:this.$dialog.find(":input[name=target]").val(),title:this.$dialog.find("input[name=title]").val()};if(!l.title){alert("You must include a title.");return false}if(!this.beforesave(l)){return false}if(!l.id){NavigationManager.addEntry(l)}else{NavigationManager.editEntry(l)}this.$dialog.dialog("close")};this.$dialog=$(".add-entry-options-"+k);$(".add-entry-"+k+"-btn").click(function(){i.open();return false});this.$dialog.find(".submit-btn").click(function(){i.save();return false})};NavigationManager={init:function(){h=$("#entry-listings");d["int"]=new a("int","Internal Link");d.ext=new a("ext","External Link");d.none=new a("none","Text Label");d["int"].$dialog.find("select[name=url]").change(function(){d["int"].$dialog.find("input[name=title]").val(b($(this)))});d.ext.beforesave=function(i){if(i.url.indexOf("://")==-1){i.url="http://"+i.url}return true};h.nestedSortable({disableNesting:"no-nest",forcePlaceholderSize:true,handle:"div.entry",helper:"clone",items:"li.entry",opacity:0.6,placeholder:"placeholder",tabSize:25,tolerance:"pointer",toleranceElement:"> div"});h.delegate("a.edit-entry-link","click",function(){var j=$(this).closest("li[entryid]"),i=j.find(".entry-type").val();d[i].open($(this));return false});h.delegate("a.delete-entry-link","click",function(){var l=$(this).closest("li[entryid]"),k=l.attr("entryid"),i=l.find(".entry-type").val(),j=l.find(".entry-title").val();if(confirm("Delete "+i+" link "+j+"?")){if(k.match(/^new-/)==null){l.find(":input").remove();l.append('<input type="hidden" name="entries[del-'+k+'][name]" value="does not matter ;)"/>');l.hide()}else{l.remove()}}return false});h.closest("form").submit(function(){h.find("div.entry").each(function(){var l=$(this),k=l.parent().parent().parent(),i=k.is("li[entryid]"),j=(i)?k.attr("entryid"):0;l.find(".entry-parent").val(j)})})},addEntry:function(l){var j=l.id||0,n=l.type,i=l.url,m=l.target,o=l.title,q=l.parent||0,p,k;if(!j){j="new-"+(++f)}p='<li class="entry" id="entry-'+j+'" entryid="'+j+'"><div class="entry"><input type="hidden" class="entry-type" name="entries['+j+'][type]" value="'+n+'"/><input type="hidden" class="entry-url" name="entries['+j+'][url]" value="'+i+'"/><input type="hidden" class="entry-target" name="entries['+j+'][target]" value="'+m+'"/><input type="hidden" class="entry-title" name="entries['+j+'][title]" value="'+o+'"/><input type="hidden" class="entry-parent" name="entries['+j+'][parent]" value="'+q+'"/>'+o+g+"</div></li>";if(q){k=h.find("li[entryid="+q+"]");if(!k.length){k=h}else{if(!k.children("ol").length){k.append("<ol/>")}k=k.children("ol")}}else{k=h}k.append(p)},editEntry:function(l){var j=l.id,n=l.type,i=l.url,m=l.target,o=l.title,q=l.parent||null,p,k=h.find("li[entryid="+j+"]").find("div.entry");if(q===null){q=k.find(':input[name="entries['+j+'][parent]"]').val()}p='<input type="hidden" class="entry-type" name="entries['+j+'][type]" value="'+n+'"/><input type="hidden" class="entry-url" name="entries['+j+'][url]" value="'+i+'"/><input type="hidden" class="entry-target" name="entries['+j+'][target]" value="'+m+'"/><input type="hidden" class="entry-title" name="entries['+j+'][title]" value="'+o+'"/><input type="hidden" class="entry-parent" name="entries['+j+'][parent]" value="'+q+'"/>'+o+g;k.html(p)}}})();$(NavigationManager.init);
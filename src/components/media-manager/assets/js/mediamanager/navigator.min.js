// Navigator javascript logic
Navigator={DOM:{$bargraph:null},Location:null,Mode:null,UploadTimer:false,UploadProgress:0,UploadTotalProgress:0,FakeBarProgress:false,Setup:function(){Navigator.Location=$(".mediamanagernavigator").attr("location");Navigator.Mode=$(".mediamanagernavigator").attr("mode");Navigator.FakeBarProgress=false;$(".directory-create").click(function(){Navigator.Mkdir();return false});$(".directory-rename").click(function(){Navigator.Rename($(this),"directory");return false});$(".directory-delete").click(function(){Navigator.Delete($(this),"directory");return false});$(".file-rename").click(function(){Navigator.Rename($(this),"file");return false});$(".file-delete").click(function(){Navigator.Delete($(this),"file");return false});$(".file-select").click(function(){Navigator.SelectFile($(this));return false});$(".mediamanagernavigator").find(".directory a, .file a").click(function(){if($(this).attr("href")!="#"){Navigator.FakeBarProgress=true;Navigator.Bargraph.Set(40);setTimeout(function(){if(Navigator.FakeBarProgress){Navigator.Bargraph.Set(50)}},200);setTimeout(function(){if(Navigator.FakeBarProgress){Navigator.Bargraph.Set(60)}},400);setTimeout(function(){if(Navigator.FakeBarProgress){Navigator.Bargraph.Set(70)}},600);setTimeout(function(){if(Navigator.FakeBarProgress){Navigator.Bargraph.Set(80)}},1000);setTimeout(function(){if(Navigator.FakeBarProgress){Navigator.Bargraph.Set(0)}},4000)}});Navigator.DOM.$bargraph=$(".mediamanagernavigator-addressbar .bargraph-inner");Navigator.DOM.$uploader=$(".multifileinput").closest("form");if(Navigator.DOM.$uploader.length>0){Navigator.DOM.$uploader.fileupload({dropzone:$(".mediamanagernavigator"),done:function(b,a){if(Navigator.UploadProgress>=100){Core.Reload()}},fail:function(b,a){$(".mediamanagernavigator").readonly(false);Navigator.Bargraph.Set(0);alert(a.errorThrown)}});Navigator.DOM.$uploader.bind("fileuploadadd",function(){if(!Navigator.Bargraph.Get()){Navigator.Bargraph.Set(5);$(".mediamanagernavigator").readonly(true)}});Navigator.DOM.$uploader.bind("fileuploadprogressall",function(b,a){Navigator.UploadProgress=parseInt(a.loaded/a.total*100,10);console.log("progress called",Navigator.UploadProgress);Navigator.Bargraph.Set(Navigator.UploadProgress,false)})}},Mkdir:function(){newname=prompt("Enter the new directory name");if(!newname){return}Navigator.Bargraph.Set(35);$.ajax({url:Core.ROOT_URL+"mediamanagernavigator/directory/mkdir",type:"post",dataType:"json",data:{dir:Navigator.Location,newdir:newname},success:function(a){if(!a){Navigator.Bargraph.Set(0);alert("Operation failed, Unknown response")}else{if(a.status){Navigator.Bargraph.Set(98);Core.Reload()}else{Navigator.Bargraph.Set(0);alert(a.message)}}},error:function(a){Navigator.Bargraph.Set(0);alert("Operation failed, Unknown response")}})},Rename:function(a,b){newname=prompt("Enter the new "+b+" name",a.attr("browsename").replace("/",""));if(!newname){return}Navigator.Bargraph.Set(35);$.ajax({url:Core.ROOT_URL+"mediamanagernavigator/"+b+"/rename",type:"post",dataType:"json",data:{dir:Navigator.Location,olddir:a.attr("browsename"),newdir:newname},success:function(c){if(!c){Navigator.Bargraph.Set(0);alert("Operation failed, Unknown response")}else{if(c.status){Navigator.Bargraph.Set(98);Core.Reload()}else{Navigator.Bargraph.Set(0);alert(c.message)}}},error:function(c){Navigator.Bargraph.Set(0);alert("Operation failed, Unknown response")}})},Delete:function(a,b){if(confirm("Confirm deletion of "+b+" "+a.attr("browsename")+"?")){Navigator.Bargraph.Set(35);$.ajax({url:Core.ROOT_URL+"mediamanagernavigator/"+b+"/delete",type:"post",dataType:"json",data:{dir:Navigator.Location,olddir:a.attr("browsename")},success:function(c){if(!c){Navigator.Bargraph.Set(0);alert("Operation failed, Unknown response")}else{if(c.status){Navigator.Bargraph.Set(98);Core.Reload()}else{Navigator.Bargraph.Set(0);alert(c.message)}}},error:function(c){Navigator.Bargraph.Set(0);alert("Operation failed, Unknown response")}})}},SelectFile:function(a){var b=a.closest(".file").find(".defaultaction").first().attr("href"),d=window.parent,e,c;if(d!=window){e=d.Core.TinyMCE.helper.targetinput;c=a.attr("selectname");d.document.getElementById(e).value=c;d.tinymce.activeEditor.windowManager.close()}else{window.open(b,"_BLANK")}},Bargraph:{_value:0,Set:function(b,a){if(typeof a=="undefined"){a=true}if(b>0){if(!Navigator.DOM.$bargraph.is(":visible")){Navigator.DOM.$bargraph.css("width","0%");Navigator.DOM.$bargraph.show()}if(a){Navigator.DOM.$bargraph.animate({width:(b+"%")},"fast")}else{Navigator.DOM.$bargraph.css("width",(b+"%"))}Navigator.Bargraph._value=b}else{Navigator.DOM.$bargraph.hide();Navigator.Bargraph._value=0}},Get:function(){return Navigator.Bargraph._value}},__last:null};